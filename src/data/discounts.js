// Discount data for specific duration packages only
export const discountData = {
  // Only specific durations have discounts, others have 0%
  "1 Day": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    }
  },
  
  "8 Days": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    }
  },
  
  "15 Days": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    }
  },
  
  "1 Month": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    }
  },
  
  "2 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    }
  },
  
  // 3 Months - 5% discount
  "3 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 5,
      "Day Batch (7:00 AM - 10:00 PM)": 5,
      "24 Hours Batch": 5
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 5,
      "Day Batch (7:00 AM - 10:00 PM)": 5,
      "24 Hours Batch": 5
    }
  },
  
  "4 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    }
  },
  
  "5 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    }
  },
  
  // 6 Months - 6% discount
  "6 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 6,
      "Day Batch (7:00 AM - 10:00 PM)": 6,
      "24 Hours Batch": 6
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 6,
      "Day Batch (7:00 AM - 10:00 PM)": 6,
      "24 Hours Batch": 6
    }
  },
  
  "7 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    }
  },
  
  "8 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 0,
      "Day Batch (7:00 AM - 10:00 PM)": 0,
      "24 Hours Batch": 0
    }
  },
  
  // 9 Months - 7% discount
  "9 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 7,
      "Day Batch (7:00 AM - 10:00 PM)": 7,
      "24 Hours Batch": 7
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 7,
      "Day Batch (7:00 AM - 10:00 PM)": 7,
      "24 Hours Batch": 7
    }
  },
  
  // 10 Months - 8% discount
  "10 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 8,
      "Day Batch (7:00 AM - 10:00 PM)": 8,
      "24 Hours Batch": 8
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 8,
      "Day Batch (7:00 AM - 10:00 PM)": 8,
      "24 Hours Batch": 8
    }
  },
  
  // 11 Months - 10% discount
  "11 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 10,
      "Day Batch (7:00 AM - 10:00 PM)": 10,
      "24 Hours Batch": 10
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 10,
      "Day Batch (7:00 AM - 10:00 PM)": 10,
      "24 Hours Batch": 10
    }
  },
  
  // 12 Months - 15% discount
  "12 Months": {
    "Dyandhara Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 15,
      "Day Batch (7:00 AM - 10:00 PM)": 15,
      "24 Hours Batch": 15
    },
    "Dyanpurn Kaksh": {
      "Night Batch (10:00 PM - 7:00 AM)": 15,
      "Day Batch (7:00 AM - 10:00 PM)": 15,
      "24 Hours Batch": 15    }
  }
};


// Helper function to get discount percentage
export const getDiscount = (duration, membershipType, timeSlot) => {
  return discountData[duration]?.[membershipType]?.[timeSlot] || 0;
};


// Calculate discounted price
export const calculateDiscountedPrice = (originalPrice, discountPercentage) => {
  if (discountPercentage < 0 || discountPercentage > 100) {
    throw new Error("Discount percentage must be between 0 and 100");
  }
  const discountAmount = (originalPrice * discountPercentage) / 100;
  return Math.round(originalPrice - discountAmount);
};

// Check if duration qualifies for female discount (3+ months)
export const qualifiesForFemaleDiscount = (duration) => {
  const monthlyDurations = ['3 Months', '4 Months', '5 Months', '6 Months', '7 Months', '8 Months', '9 Months', '10 Months', '11 Months', '12 Months'];
  return monthlyDurations.includes(duration);
};

// Calculate total discount including female discount
export const calculateTotalDiscount = (duration, membershipType, timeSlot, isFemale = false) => {
  const baseDiscount = getDiscount(duration, membershipType, timeSlot);
  const femaleDiscount = isFemale && qualifiesForFemaleDiscount(duration) ? 10 : 0;
  return baseDiscount + femaleDiscount;
};

// Calculate final price with all applicable discounts
export const calculateFinalPrice = (originalPrice, duration, membershipType, timeSlot, isFemale = false) => {
  const totalDiscount = calculateTotalDiscount(duration, membershipType, timeSlot, isFemale);
  return calculateDiscountedPrice(originalPrice, totalDiscount);
};

// Registration fee constants
export const REGISTRATION_FEE = 300;
export const REGISTRATION_VALIDITY_DAYS = 365; // 1 year

// Check if registration fee should be applied
export const shouldApplyRegistrationFee = (userRegistrationDate, lastPackageDate = null) => {
  if (!userRegistrationDate) return true; // First time user
  
  const registrationDate = new Date(userRegistrationDate);
  const currentDate = new Date();
  
  // If no previous package, check if more than a year since registration
  if (!lastPackageDate) {
    const daysSinceRegistration = Math.floor((currentDate - registrationDate) / (1000 * 60 * 60 * 24));
    return daysSinceRegistration > REGISTRATION_VALIDITY_DAYS;
  }
  
  // If there's a previous package, check if more than a year since last package
  const lastPackage = new Date(lastPackageDate);
  const daysSinceLastPackage = Math.floor((currentDate - lastPackage) / (1000 * 60 * 60 * 24));
  return daysSinceLastPackage > REGISTRATION_VALIDITY_DAYS;
};

// Calculate total price including registration fee
export const calculateTotalPriceWithFees = (originalPrice, duration, membershipType, timeSlot, isFemale = false, userRegistrationDate = null, lastPackageDate = null) => {
  const discountedPrice = calculateFinalPrice(originalPrice, duration, membershipType, timeSlot, isFemale);
  const registrationFee = shouldApplyRegistrationFee(userRegistrationDate, lastPackageDate) ? REGISTRATION_FEE : 0;
  return discountedPrice + registrationFee;
};


// Update discount for specific plan
export const updateDiscount = (duration, membershipType, timeSlot, newDiscount) => {
  if (discountData[duration] && discountData[duration][membershipType]) {
    discountData[duration][membershipType][timeSlot] = newDiscount;
    return true;
  }
  return false;
};

