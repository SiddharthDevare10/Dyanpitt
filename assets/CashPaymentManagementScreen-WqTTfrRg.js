import{u as P,b as w,r as n,c as u,j as e}from"./index-DJTMSaIU.js";import{A as k}from"./arrow-left-CTsakzoZ.js";import{c as j}from"./createLucideIcon-D3XSCUrN.js";import{C as S}from"./check-CwCds5QW.js";import{X as I}from"./x-pkKEGEq6.js";const D=j("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),A=j("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function T(){const p=P(),{user:M}=w(),[t,c]=n.useState([]),[N,d]=n.useState(!0),[l,o]=n.useState(null),[m,r]=n.useState(""),[a,h]=n.useState(null),[g,i]=n.useState(!1);n.useEffect(()=>{v()},[]);const v=async()=>{try{d(!0);const s=await u.request("/booking/pending-cash-payments");s.success?c(s.pendingBookings||[]):(console.error("Failed to fetch pending payments:",s.message),alert("Failed to fetch pending payments: "+s.message))}catch(s){console.error("Error fetching pending payments:",s),alert("Error fetching pending payments. Please try again.")}finally{d(!1)}},y=s=>{h(s),r("Payment collected in cash at center"),i(!0)},f=async()=>{if(a)try{o(a.userId);const s=await u.request("/booking/confirm-cash-payment",{method:"POST",body:JSON.stringify({bookingId:a.bookingId,userId:a.userId,adminNotes:m})});s.success?(alert(s.message),c(b=>b.filter(C=>C.userId!==a.userId)),i(!1),h(null),r("")):alert("Failed to confirm payment: "+s.message)}catch(s){console.error("Error confirming payment:",s),alert("Error confirming payment. Please try again.")}finally{o(null)}},x=s=>new Date(s).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return N?e.jsx("div",{className:"main-container",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading pending cash payments..."})]})}):e.jsxs("div",{className:"main-container admin-container",children:[e.jsx("button",{onClick:()=>p("/admin"),className:"back-button",children:e.jsx(k,{size:20,color:"white"})}),e.jsxs("div",{className:"header-section",children:[e.jsx("h1",{className:"main-title",children:"Cash Payment Management"}),e.jsxs("p",{className:"main-subtitle",children:["Manage pending cash payment collections (",t.length," pending)"]})]}),e.jsx("div",{className:"admin-content",children:t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(D,{size:64,className:"empty-icon"}),e.jsx("h3",{children:"No Pending Cash Payments"}),e.jsx("p",{children:"All cash payments have been collected or there are no pending requests."})]}):e.jsx("div",{className:"payments-grid",children:t.map(s=>e.jsxs("div",{className:"payment-card",children:[e.jsxs("div",{className:"payment-header",children:[e.jsxs("div",{className:"user-info",children:[s.avatar?e.jsx("img",{src:s.avatar,alt:s.fullName,className:"user-avatar"}):e.jsx("div",{className:"user-avatar-placeholder",children:e.jsx(A,{size:24})}),e.jsxs("div",{className:"user-details",children:[e.jsx("h3",{className:"user-name",children:s.fullName}),e.jsx("p",{className:"user-email",children:s.email}),e.jsx("p",{className:"user-phone",children:s.phoneNumber})]})]}),e.jsxs("div",{className:"payment-amount",children:[e.jsxs("span",{className:"amount",children:["₹",s.totalAmount]}),e.jsx("span",{className:"status-badge pending",children:"Cash Pending"})]})]}),e.jsxs("div",{className:"payment-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Membership:"}),e.jsx("span",{className:"detail-value",children:s.membershipType})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Time Slot:"}),e.jsx("span",{className:"detail-value",children:s.timeSlot})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Duration:"}),e.jsx("span",{className:"detail-value",children:s.duration})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Start Date:"}),e.jsx("span",{className:"detail-value",children:x(s.membershipStartDate)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Request Date:"}),e.jsx("span",{className:"detail-value",children:x(s.requestDate)})]})]}),e.jsx("div",{className:"payment-actions",children:e.jsx("button",{onClick:()=>y(s),disabled:l===s.userId,className:"confirm-button",children:l===s.userId?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"button-spinner"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{size:16}),"Confirm Payment Collected"]})})})]},s.userId))})}),g&&a&&e.jsx("div",{className:"modal-overlay",onClick:()=>i(!1),children:e.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Confirm Cash Payment Collection"}),e.jsx("button",{className:"modal-close",onClick:()=>i(!1),children:e.jsx(I,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"confirmation-details",children:[e.jsx("h3",{children:"Payment Details"}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"User:"}),e.jsx("span",{children:a.fullName})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"Email:"}),e.jsx("span",{children:a.email})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"Amount:"}),e.jsxs("span",{children:["₹",a.totalAmount]})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{children:"Membership:"}),e.jsx("span",{children:a.membershipType})]})]}),e.jsxs("div",{className:"admin-notes-section",children:[e.jsx("label",{className:"input-label",children:"Admin Notes (Optional)"}),e.jsx("textarea",{value:m,onChange:s=>r(s.target.value),placeholder:"Add notes about the payment collection...",className:"admin-notes-input",rows:"3"})]}),e.jsxs("div",{className:"confirmation-warning",children:[e.jsx("p",{children:"⚠️ This action will:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Mark the payment as collected"}),e.jsx("li",{children:"Generate and send the user's Dyanpitt ID"}),e.jsx("li",{children:"Allow the user to login to their account"}),e.jsx("li",{children:"Send a welcome email with their Dyanpitt ID"})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:()=>i(!1),className:"cancel-button",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:l===a.userId,className:"confirm-button primary",children:l===a.userId?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"button-spinner"}),"Processing..."]}):"Confirm Collection"})]})]})})]})}export{T as default};
