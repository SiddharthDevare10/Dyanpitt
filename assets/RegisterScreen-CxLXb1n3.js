import{u as ae,r as c,j as e,c as b,L as te}from"./index-DJTMSaIU.js";import{D as ie,C as ne}from"./CustomDropdown-C5EAlaue.js";import le from"./CongratulationsScreen-BfdaTzJp.js";import{P as oe}from"./PasswordStrengthIndicator-D0BFkSjY.js";import{C as ce}from"./check-CwCds5QW.js";import{E as V,a as U}from"./eye-D6RneIdP.js";import"./createLucideIcon-D3XSCUrN.js";import"./calendar-C-Fi1QuP.js";import"./arrow-right-RuMd9P_v.js";function Pe(){const y=ae(),[f,P]=c.useState("email"),[a,N]=c.useState(()=>(sessionStorage.removeItem("registrationFormData"),{email:"",otp:"",fullName:"",countryCode:"+91",phoneNumber:"",dateOfBirth:"",gender:"",currentAddress:"",password:"",confirmPassword:"",profilePicture:null,profilePictureBase64:null})),[k,W]=c.useState(!1),[C,X]=c.useState(!1),[o,d]=c.useState(!1),[g,E]=c.useState(0),[t,n]=c.useState({}),[$,w]=c.useState({}),[H,M]=c.useState(!1),[R,G]=c.useState(!1);c.useEffect(()=>{let r;return g>0&&(r=setInterval(()=>{E(s=>s-1)},1e3)),()=>{r&&clearInterval(r)}},[g]),c.useEffect(()=>{(async()=>{if(!(f!=="profile"||R))try{G(!0),await Y(a.email)}catch(s){console.error("Error auto-checking tour data:",s)}})()},[f,R,a.email]),c.useEffect(()=>{new URLSearchParams(window.location.search).get("token")&&(window.history.replaceState({},document.title,window.location.pathname),y("/dashboard"))},[y]),c.useEffect(()=>()=>{const r=window.location.pathname;!r.includes("/register")&&!r.includes("/login")&&sessionStorage.removeItem("registrationFormData")},[]);const Y=async r=>{try{if(!r)return;let s;try{s=await b.request(`/tour/requests/${encodeURIComponent(r)}`)}catch{return}if(s.success&&s.data&&s.data.length>0){const l=s.data[0];N(i=>({...i,fullName:i.fullName||l.fullName||"",gender:i.gender||l.gender||""})),M(!0),setTimeout(()=>{M(!1)},5e3)}}catch(s){console.error("Error fetching tour data:",s)}},O=r=>{const s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return r?s.test(r)?r.length>254?"Email address is too long (maximum 254 characters)":"":"Please enter a valid email address (e.g., user@example.com)":"Email address is required"},B=r=>r?r.length<6?"Please enter the complete 6-digit verification code":r.length>6?"Verification code must be exactly 6 digits":/^\d+$/.test(r)?"":"Verification code must contain only numbers (0-9)":"Verification code is required",S=r=>r?r.trim().length<2?"Full name must be at least 2 characters long":r.trim().length>100?"Full name is too long (maximum 100 characters)":/^[a-zA-Z\s'-.]+$/.test(r.trim())?r.trim().split(/\s+/).length<2?"Please enter your first and last name":"":"Full name can only contain letters, spaces, hyphens, apostrophes, and periods":"Full name is required",T=r=>r?r.length!==10?"Phone number must be exactly 10 digits long":/^\d+$/.test(r)?/^[6-9]/.test(r)?"":"Phone number must start with 6, 7, 8, or 9 (valid Indian mobile numbers)":"Phone number must contain only numbers (0-9)":"Phone number is required",F=r=>{if(!r)return"Date of birth is required";const s=new Date,l=new Date(r),i=s.getFullYear()-l.getFullYear();return i<12?"You must be at least 12 years old":i>120?"Please enter a valid date of birth":""},A=r=>r?"":"Please select your gender",D=r=>r?r.length<10?"Address must be at least 10 characters":"":"Current address is required",L=r=>r?r.length<8?"Password must be at least 8 characters long":/[a-z]/.test(r)?/[A-Z]/.test(r)?/\d/.test(r)?/[!@#$%^&*(),.?":{}|<>]/.test(r)?"":"Password must contain at least one special character":"Password must contain at least one number":"Password must contain at least one uppercase letter":"Password must contain at least one lowercase letter":"Password is required",j=(r,s)=>r?r!==s?"Passwords do not match. Please make sure both passwords are identical":r.length===0?"Confirm password field cannot be empty":"":"Please confirm your password",q=async()=>{const r=O(a.email);if(r){n({email:r}),w({email:!0});return}d(!0),n({});try{const s=await b.sendOtp(a.email);s.success?(P("otp"),E(60)):n({general:s.message||"Failed to send verification code. Please check your email address and try again."})}catch(s){console.error("Error in handleSendOtp:",s);let l="Unable to send verification code. Please try again in a few moments.";if(s.message&&s.message.includes("already registered")){n({email:"The email already exists"}),d(!1);return}else if(s.message&&s.message.includes("already exists")){n({email:"The email already exists"}),d(!1);return}else s.message&&(s.message.includes("network")||s.message.includes("Network error"))?l="Network error. Please check your internet connection and try again.":s.message&&s.message.includes("timeout")?l="Connection timed out. Please check your internet connection and try again.":s.message&&s.message.includes("Email sending timeout")?l="Email service is taking longer than expected. The OTP may still be sent to your email. Please check your inbox or try again in a few moments.":s.message&&s.message.includes("SMTP")?l="Email service temporarily unavailable. Please try again in a few moments.":s.message&&s.message.includes("EMAIL_SEND_FAILED")?l="Failed to send OTP email. Please check your email address and try again.":s.message&&(l=s.message);n({general:l})}finally{d(!1)}},z=async()=>{const r=B(a.otp);if(r){n({otp:r}),w({otp:!0});return}d(!0),n({});try{const s=await b.verifyOtp(a.email,a.otp);s.success?P("profile"):n({general:s.message||"Invalid OTP. Please try again."})}catch(s){console.error("OTP verification error:",s),console.error("Error details:",s.message),s.message&&s.message.includes("Validation failed")?n({otp:"Please enter a valid 6-digit OTP (numbers only)"}):s.message&&s.message.includes("Invalid OTP")?n({otp:"Invalid OTP. Please check and try again."}):s.message&&s.message.includes("expired")?n({otp:"OTP has expired. Please request a new one."}):n({general:s.message||"Invalid OTP. Please try again."})}finally{d(!1)}},K=async()=>{if(!(g>0)){d(!0);try{const r=await b.sendOtp(a.email);r.success?E(60):n({general:r.message||"Failed to resend OTP. Please try again."})}catch(r){n({general:r.message||"Failed to resend OTP. Please try again."})}finally{d(!1)}}},u=(r,s)=>{const l={...a,[r]:s};if(N(l),sessionStorage.setItem("registrationFormData",JSON.stringify(l)),t.general&&n(i=>({...i,general:""})),t[r]&&n(i=>({...i,[r]:""})),$[r]){let i="";switch(r){case"email":i=O(s);break;case"otp":i=B(s);break;case"fullName":i=S(s);break;case"phoneNumber":i=T(s);break;case"dateOfBirth":i=F(s);break;case"gender":i=A(s);break;case"currentAddress":i=D(s);break;case"password":if(i=L(s),$.confirmPassword){const m=j(a.confirmPassword,s);n(x=>({...x,confirmPassword:m}))}break;case"confirmPassword":i=j(s,a.password);break}n(m=>({...m,[r]:i}))}},Z=r=>{const s=r.target.files[0];if(!s){N(l=>({...l,profilePicture:null,profilePictureBase64:null}));return}if(s){if(!s.type.startsWith("image/")){n(i=>({...i,profilePicture:"Please select a valid image file"}));return}if(s.size>5*1024*1024){n(i=>({...i,profilePicture:"File size must be less than 5MB"}));return}n(i=>({...i,profilePicture:""})),N(i=>({...i,profilePicture:s,profilePictureBase64:null}));const l=new FileReader;l.onload=i=>{const m=i.target.result,x=m.length*.75,v=4*1024*1024;if(x>v){console.error("Profile picture is too large for localStorage. Please use a smaller image."),n(h=>({...h,profilePicture:"Profile picture is too large. Please choose an image smaller than 4MB."}));return}try{N(h=>({...h,profilePictureBase64:m}))}catch(h){h.name==="QuotaExceededError"?(console.error("localStorage quota exceeded."),n(I=>({...I,profilePicture:"Profile picture is too large for storage. Please use a smaller image."}))):(console.error("Error saving profile picture:",h),n(I=>({...I,profilePicture:"Error saving profile picture. Please try again."})))}},l.readAsDataURL(s)}},p=r=>{w(l=>({...l,[r]:!0}));let s="";switch(r){case"email":s=O(a.email);break;case"otp":s=B(a.otp);break;case"fullName":s=S(a.fullName);break;case"phoneNumber":s=T(a.phoneNumber);break;case"dateOfBirth":s=F(a.dateOfBirth);break;case"gender":s=A(a.gender);break;case"currentAddress":s=D(a.currentAddress);break;case"password":s=L(a.password);break;case"confirmPassword":s=j(a.confirmPassword,a.password);break}n(l=>({...l,[r]:s}))},_=()=>{const r=S(a.fullName),s=T(a.phoneNumber),l=F(a.dateOfBirth),i=A(a.gender),m=D(a.currentAddress),x=L(a.password),v=j(a.confirmPassword,a.password);return n({fullName:r,phoneNumber:s,dateOfBirth:l,gender:i,currentAddress:m,password:x,confirmPassword:v}),w({fullName:!0,phoneNumber:!0,dateOfBirth:!0,gender:!0,currentAddress:!0,password:!0,confirmPassword:!0}),!r&&!s&&!l&&!i&&!m&&!x&&!v},J=async()=>{if(_()){d(!0),n(r=>({...r,general:""}));try{const r=`${a.countryCode}${a.phoneNumber}`;if((await b.checkPhoneExists(r)).exists){n({phoneNumber:"This phone number is already registered with another account. Please use a different phone number."}),d(!1);return}const l={email:a.email,password:a.password,fullName:a.fullName,phoneNumber:`+91${a.phoneNumber}`,dateOfBirth:a.dateOfBirth,gender:a.gender,currentAddress:a.currentAddress};a.profilePicture instanceof File&&(l.avatar=a.profilePicture);const i=await b.register(l);i.success?(sessionStorage.removeItem("registrationFormData"),P("congratulations")):n({general:i.message||"Registration failed. Please try again."})}catch(r){r.message&&r.message.includes("phone number already exists")?n({phoneNumber:"This phone number is already registered. Please use a different number."}):r.message&&r.message.includes("email already exists")?n({general:"This email is already registered. Please sign in instead."}):n({general:r.message||"Registration failed. Please try again."})}finally{d(!1)}}},Q=()=>{y("/login")},ee=()=>e.jsxs("div",{className:"main-container",children:[e.jsxs(te,{to:"/",className:"back-button",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19 12H5M12 19L5 12L12 5",stroke:"#ffffff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"‚Üê Back"]}),e.jsxs("div",{className:"header-section",children:[e.jsx("div",{className:"logo-container",style:{textAlign:"center",marginBottom:"2rem"},children:e.jsx("img",{src:"./Logo.png",alt:"Logo",style:{width:"150px",height:"150px",objectFit:"contain",borderRadius:"50%"}})}),e.jsx("h1",{className:"main-title",children:"Create your Account"})]}),t.general&&e.jsx("div",{className:"error-message general-error",children:t.general}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Email Address"}),e.jsx("input",{type:"email",placeholder:"Enter your email",value:a.email,onChange:r=>u("email",r.target.value),onBlur:()=>p("email"),onKeyPress:r=>r.key==="Enter"&&q(),className:`form-input ${t.email?"input-error":""}`,disabled:o}),t.email&&e.jsx("div",{className:"error-message",children:t.email})]}),e.jsx("button",{onClick:q,className:"login-button",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Sending OTP..."]}):"Send OTP"}),e.jsx("div",{className:"signup-link",children:e.jsxs("p",{className:"signup-text",children:["Already have an account?"," ",e.jsx("button",{onClick:Q,className:"signup-button",disabled:o,children:"Sign in"})]})})]}),re=()=>e.jsxs("div",{className:"main-container",children:[e.jsx("button",{onClick:()=>P("email"),className:"back-button",disabled:o,children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19 12H5M12 19L5 12L12 5",stroke:"#ffffff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsxs("div",{className:"header-section",children:[e.jsx("h1",{className:"main-title",children:"Verify your Email"}),e.jsxs("p",{className:"main-subtitle",children:["Enter the 6-digit code sent to ",e.jsx("span",{className:"semibold-email",children:a.email.replace(/(.{2})(.*)(@.*)/,"$1***$3")})]})]}),t.general&&e.jsx("div",{className:"error-message general-error",children:t.general}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Enter your OTP"}),e.jsx("input",{type:"text",placeholder:"XXXXXX",value:a.otp,onChange:r=>u("otp",r.target.value.replace(/\D/g,"").slice(0,6)),onBlur:()=>p("otp"),onKeyPress:r=>r.key==="Enter"&&z(),className:`form-input ${t.otp?"input-error":""}`,disabled:o,maxLength:6}),t.otp&&e.jsx("div",{className:"error-message",children:t.otp})]}),e.jsx("button",{onClick:z,className:"login-button",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Verifying..."]}):"Verify OTP"}),e.jsxs("div",{className:"form-options",children:[e.jsx("span",{className:"checkbox-label",children:g>0?`Resend OTP in ${g}s`:"Didn't receive OTP?"}),e.jsx("button",{onClick:K,className:"forgot-password",disabled:o||g>0,children:"Resend OTP"})]})]}),se=()=>e.jsxs("div",{className:"main-container profile-completion-form",children:[e.jsx("button",{onClick:()=>P("otp"),className:"back-button",disabled:o,children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19 12H5M12 19L5 12L12 5",stroke:"#ffffff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsxs("div",{className:"header-section",children:[e.jsx("h1",{className:"main-title",children:"Complete your Profile"}),e.jsx("p",{className:"main-subtitle",children:"Fill in your details to complete registration"})]}),H&&e.jsxs("div",{className:"tour-data-indicator register-tour-data-indicator",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 12l2 2 4-4"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"})]}),"Great! We found you visited Dyanpitt for a tour and pre-populated your name and gender from the Tour Details."]}),t.general&&e.jsx("div",{className:"error-message general-error",children:t.general}),e.jsx("div",{className:"input-group",children:e.jsx("div",{className:"profile-picture-upload",children:e.jsx("div",{className:"profile-picture-square",children:a.profilePictureBase64?e.jsx("img",{src:a.profilePictureBase64,alt:"Profile Preview",className:"register-profile-preview-image"}):a.fullName?a.fullName.charAt(0).toUpperCase():"U"})})}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Upload Profile Picture"}),e.jsxs("div",{className:"file-upload-container",children:[e.jsx("input",{type:"file",name:"profilePicture",accept:"image/*",onChange:Z,className:"file-input-hidden",id:"profilePicture"},a.profilePicture?a.profilePicture.name:"no-file"),e.jsxs("label",{htmlFor:"profilePicture",className:`file-upload-button ${t.profilePicture?"input-error":""}`,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),e.jsx("circle",{cx:"12",cy:"13",r:"4"})]}),a.profilePicture?"Change Picture":"Upload Profile Picture"]}),a.profilePicture&&e.jsx("div",{className:"file-preview",children:e.jsxs("span",{className:"file-name",children:["Image: ",a.profilePicture.name]})})]}),t.profilePicture&&e.jsx("span",{className:"error-message",children:t.profilePicture})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Email Address"}),e.jsxs("div",{className:"verified-input-wrapper",children:[e.jsx("input",{type:"email",value:a.email,className:"form-input verified-input",disabled:!0}),e.jsx("div",{className:"verified-icon",children:e.jsx(ce,{size:20,color:"#10b981"})})]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Full Name"}),e.jsx("input",{type:"text",placeholder:"Enter your full name",value:a.fullName,onChange:r=>u("fullName",r.target.value),onBlur:()=>p("fullName"),className:`form-input ${t.fullName?"input-error":""}`,disabled:o}),t.fullName&&e.jsx("div",{className:"error-message",children:t.fullName})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Mobile Number"}),e.jsxs("div",{className:"phone-input-wrapper",children:[e.jsx("div",{className:"country-code-display",children:"+91"}),e.jsx("input",{type:"tel",placeholder:"Enter 10-digit mobile number",value:a.phoneNumber,onChange:r=>u("phoneNumber",r.target.value.replace(/\D/g,"").slice(0,10)),onBlur:()=>p("phoneNumber"),className:`form-input phone-number-input ${t.phoneNumber?"input-error":""}`,disabled:o,maxLength:10})]}),t.phoneNumber&&e.jsx("div",{className:"error-message",children:t.phoneNumber})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Date of Birth"}),e.jsx(ie,{name:"dateOfBirth",value:a.dateOfBirth,onChange:r=>u("dateOfBirth",r.target.value),className:t.dateOfBirth?"input-error":"",error:!!t.dateOfBirth,placeholder:"e.g., March 15, 1995"}),t.dateOfBirth&&e.jsx("div",{className:"error-message",children:t.dateOfBirth})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Gender"}),e.jsx(ne,{name:"gender",value:a.gender,onChange:r=>u("gender",r.target.value),onBlur:()=>p("gender"),options:[{value:"male",label:"Male"},{value:"female",label:"Female"},{value:"other",label:"Other"},{value:"prefer-not-to-say",label:"Prefer not to say"}],placeholder:"Select your gender",className:"form-input",error:t.gender,disabled:o}),t.gender&&e.jsx("div",{className:"error-message",children:t.gender})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Current Address"}),e.jsx("textarea",{name:"currentAddress",placeholder:"Enter your current address",value:a.currentAddress,onChange:r=>u("currentAddress",r.target.value),onBlur:()=>p("currentAddress"),className:`form-input ${t.currentAddress?"input-error":""}`,rows:"3",disabled:o}),t.currentAddress&&e.jsx("div",{className:"error-message",children:t.currentAddress})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Password"}),e.jsxs("div",{className:"password-wrapper",children:[e.jsx("input",{type:k?"text":"password",placeholder:"Create a password",value:a.password,onChange:r=>u("password",r.target.value),onBlur:()=>p("password"),className:`form-input password-input ${t.password?"input-error":""}`,disabled:o}),e.jsx("button",{type:"button",onClick:()=>W(!k),className:"password-toggle",disabled:o,children:k?e.jsx(V,{size:20}):e.jsx(U,{size:20})})]}),t.password&&e.jsx("div",{className:"error-message",children:t.password}),e.jsx(oe,{password:a.password})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Confirm Password"}),e.jsxs("div",{className:"password-wrapper",children:[e.jsx("input",{type:C?"text":"password",placeholder:"Confirm your password",value:a.confirmPassword,onChange:r=>u("confirmPassword",r.target.value),onBlur:()=>p("confirmPassword"),className:`form-input password-input ${t.confirmPassword?"input-error":""}`,disabled:o}),e.jsx("button",{type:"button",onClick:()=>X(!C),className:"password-toggle",disabled:o,children:C?e.jsx(V,{size:20}):e.jsx(U,{size:20})})]}),t.confirmPassword&&e.jsx("div",{className:"error-message",children:t.confirmPassword})]}),e.jsx("button",{onClick:J,className:"login-button",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Creating Account..."]}):"Continue"})]});return e.jsxs(e.Fragment,{children:[f==="email"&&ee(),f==="otp"&&re(),f==="profile"&&se(),f==="congratulations"&&e.jsx(le,{email:a.email})]})}export{Pe as default};
