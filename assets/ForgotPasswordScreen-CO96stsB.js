import{u as M,r as l,j as e,c as h}from"./index-DJTMSaIU.js";import{P as A}from"./PasswordStrengthIndicator-D0BFkSjY.js";import{E as L,a as F}from"./eye-D6RneIdP.js";import"./createLucideIcon-D3XSCUrN.js";function Y(){const k=M(),[f,m]=l.useState("email"),[a,$]=l.useState({email:"",otp:"",newPassword:"",confirmPassword:""}),[x,O]=l.useState(!1),[P,B]=l.useState(!1),[o,c]=l.useState(!1),[d,j]=l.useState(0),[t,n]=l.useState({}),[E,u]=l.useState({});l.useEffect(()=>{let s;return d>0&&(s=setInterval(()=>{j(r=>r-1)},1e3)),()=>clearInterval(s)},[d]);const b=s=>{const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return s?r.test(s)?s.length>254?"Email address is too long (maximum 254 characters)":"":"Please enter a valid email address (e.g., user@example.com)":"Email address is required"},N=s=>s?s.length<6?"Please enter the complete 6-digit verification code":s.length>6?"Verification code must be exactly 6 digits":/^\d+$/.test(s)?"":"Verification code must contain only numbers (0-9)":"Verification code is required",y=s=>s?s.length<8?"Password must be at least 8 characters long":/[a-z]/.test(s)?/[A-Z]/.test(s)?/\d/.test(s)?/[!@#$%^&*(),.?":{}|<>]/.test(s)?"":"Password must contain at least one special character":"Password must contain at least one number":"Password must contain at least one uppercase letter":"Password must contain at least one lowercase letter":"Password is required",w=(s,r)=>s?s!==r?"Passwords do not match. Please make sure both passwords are identical":"":"Please confirm your password",C=async()=>{const s=b(a.email);if(s){n({email:s}),u({email:!0});return}c(!0),n({});try{const r=await h.forgotPassword(a.email);r.success?(m("otp"),j(60)):n({general:r.message||"Failed to send reset code. Please check your email address and try again."})}catch(r){console.error("Error in handleSendOtp (forgot password):",r),r.message&&r.message.includes("not found")?n({email:"No account found with this email address"}):r.message&&(r.message.includes("network")||r.message.includes("Network error"))?n({general:"Network error. Please check your internet connection and try again."}):r.message&&r.message.includes("timeout")?n({general:"Request timed out. Please check your connection and try again."}):n({general:r.message||"Unable to send reset code. Please try again in a few moments."})}finally{c(!1)}},S=async()=>{const s=N(a.otp);if(s){n({otp:s}),u({otp:!0});return}c(!0),n({});try{const r=await h.verifyResetOtp(a.email,a.otp);r.success?m("reset"):n({general:r.message||"Invalid verification code. Please try again."})}catch(r){n({general:r.message||"Invalid verification code. Please try again."})}finally{c(!1)}},I=async()=>{if(!(d>0)){c(!0);try{const s=await h.forgotPassword(a.email);s.success?j(60):n({general:s.message||"Failed to resend verification code. Please try again."})}catch(s){n({general:s.message||"Failed to resend verification code. Please try again."})}finally{c(!1)}}},R=async()=>{const s=y(a.newPassword),r=w(a.confirmPassword,a.newPassword);if(s||r){n({newPassword:s,confirmPassword:r}),u({newPassword:!0,confirmPassword:!0});return}c(!0),n({});try{const i=await h.resetPassword(a.email,a.otp,a.newPassword);i.success?(n({general:"Password reset successful! You can now sign in with your new password."}),setTimeout(()=>{k("/login")},2e3)):n({general:i.message||"Failed to reset password. Please try again."})}catch(i){n({general:i.message||"Failed to reset password. Please try again."})}finally{c(!1)}},g=(s,r)=>{if($(i=>({...i,[s]:r})),t.general&&n(i=>({...i,general:""})),E[s]){let i="";switch(s){case"email":i=b(r);break;case"otp":i=N(r);break;case"newPassword":if(i=y(r),E.confirmPassword){const v=w(a.confirmPassword,r);n(D=>({...D,confirmPassword:v}))}break;case"confirmPassword":i=w(r,a.newPassword);break}n(v=>({...v,[s]:i}))}},p=s=>{u(i=>({...i,[s]:!0}));let r="";switch(s){case"email":r=b(a.email);break;case"otp":r=N(a.otp);break;case"newPassword":r=y(a.newPassword);break;case"confirmPassword":r=w(a.confirmPassword,a.newPassword);break}n(i=>({...i,[s]:r}))},V=()=>{k("/login")},T=()=>e.jsxs("div",{className:"main-container",children:[e.jsxs("div",{className:"header-section",children:[e.jsx("div",{className:"logo-container",style:{textAlign:"center",marginBottom:"2rem"},children:e.jsx("img",{src:"./Logo.png",alt:"Logo",style:{width:"150px",height:"150px",objectFit:"contain",borderRadius:"50%"}})}),e.jsx("h1",{className:"main-title",children:"Reset your Password"}),e.jsx("p",{className:"main-subtitle",children:"Enter your email address and we'll send you a verification code"})]}),t.general&&e.jsx("div",{className:`error-message general-error ${t.general.includes("successful")?"success-message":""}`,children:t.general}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Email Address"}),e.jsx("input",{type:"email",placeholder:"Enter your email",value:a.email,onChange:s=>g("email",s.target.value),onBlur:()=>p("email"),onKeyPress:s=>s.key==="Enter"&&C(),className:`form-input ${t.email?"input-error":""}`,disabled:o}),t.email&&e.jsx("div",{className:"error-message",children:t.email})]}),e.jsx("button",{onClick:C,className:"login-button",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Sending Code..."]}):"Send OTP"}),e.jsx("div",{className:"signup-link",children:e.jsxs("p",{className:"signup-text",children:["Remember your password?"," ",e.jsx("button",{onClick:V,className:"signup-button",disabled:o,children:"Sign in"})]})})]}),z=()=>e.jsxs("div",{className:"main-container",children:[e.jsx("button",{onClick:()=>m("email"),className:"back-button",disabled:o,children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19 12H5M12 19L5 12L12 5",stroke:"#ffffff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsxs("div",{className:"header-section",children:[e.jsx("h1",{className:"main-title",children:"Verify your Email"}),e.jsxs("p",{className:"main-subtitle",children:["Enter the 6-digit code sent to ",e.jsx("span",{className:"semibold-email",children:a.email.replace(/(.{2})(.*)(@.*)/,"$1***$3")})]})]}),t.general&&e.jsx("div",{className:"error-message general-error",children:t.general}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Enter Verification Code"}),e.jsx("input",{type:"text",placeholder:"Enter 6-digit code",value:a.otp,onChange:s=>g("otp",s.target.value.replace(/\D/g,"").slice(0,6)),onBlur:()=>p("otp"),onKeyPress:s=>s.key==="Enter"&&S(),className:`form-input ${t.otp?"input-error":""}`,disabled:o,maxLength:6}),t.otp&&e.jsx("div",{className:"error-message",children:t.otp})]}),e.jsx("button",{onClick:S,className:"login-button",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Verifying..."]}):"Verify OTP"}),e.jsxs("div",{className:"form-options",children:[e.jsx("span",{className:"checkbox-label",children:d>0?`Resend code in ${d}s`:"Didn't receive the code?"}),e.jsx("button",{onClick:I,className:"forgot-password",disabled:o||d>0,children:"Resend Code"})]})]}),q=()=>e.jsxs("div",{className:"main-container",children:[e.jsx("button",{onClick:()=>m("otp"),className:"back-button",disabled:o,children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19 12H5M12 19L5 12L12 5",stroke:"#ffffff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsxs("div",{className:"header-section",children:[e.jsx("h1",{className:"main-title",children:"Create New Password"}),e.jsx("p",{className:"main-subtitle",children:"Enter your new password below"})]}),t.general&&e.jsx("div",{className:`error-message general-error ${t.general.includes("successful")?"success-message":""}`,children:t.general}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"New Password"}),e.jsxs("div",{className:"password-wrapper",children:[e.jsx("input",{type:x?"text":"password",placeholder:"Enter new password",value:a.newPassword,onChange:s=>g("newPassword",s.target.value),onBlur:()=>p("newPassword"),className:`form-input password-input ${t.newPassword?"input-error":""}`,disabled:o}),e.jsx("button",{type:"button",onClick:()=>O(!x),className:"password-toggle",disabled:o,children:x?e.jsx(L,{size:20}):e.jsx(F,{size:20})})]}),t.newPassword&&e.jsx("div",{className:"error-message",children:t.newPassword}),e.jsx(A,{password:a.newPassword})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Confirm New Password"}),e.jsxs("div",{className:"password-wrapper",children:[e.jsx("input",{type:P?"text":"password",placeholder:"Confirm new password",value:a.confirmPassword,onChange:s=>g("confirmPassword",s.target.value),onBlur:()=>p("confirmPassword"),onKeyPress:s=>s.key==="Enter"&&R(),className:`form-input password-input ${t.confirmPassword?"input-error":""}`,disabled:o}),e.jsx("button",{type:"button",onClick:()=>B(!P),className:"password-toggle",disabled:o,children:P?e.jsx(L,{size:20}):e.jsx(F,{size:20})})]}),t.confirmPassword&&e.jsx("div",{className:"error-message",children:t.confirmPassword})]}),e.jsx("button",{onClick:R,className:"login-button",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Resetting Password..."]}):"Reset Password"})]});return e.jsxs(e.Fragment,{children:[f==="email"&&T(),f==="otp"&&z(),f==="reset"&&q()]})}export{Y as default};
