import{u as k,a as R,r as m,j as l}from"./index-DJTMSaIU.js";import{Q as C}from"./browser-DFX9LUgJ.js";function q(){const u=k(),p=R(),[o,S]=m.useState(""),[s,b]=m.useState(null),[v,g]=m.useState(!1);m.useEffect(()=>{const t=p.state?.tourData;if(!t){u("/tour");return}b(t),y(t)},[p.state,u]);const y=async t=>{try{const e={type:"VISITOR_PASS",id:t._id||"unknown",name:t.fullName||"Unknown",email:t.email||"unknown@email.com",contact:t.phoneNumber||"N/A",gender:t.gender?t.gender.charAt(0).toUpperCase()+t.gender.slice(1):"N/A",tourDate:t.tourDate||new Date().toISOString(),tourTime:t.tourTime||"N/A",generatedAt:new Date().toISOString(),status:"pending"},c=await C.toDataURL(JSON.stringify(e),{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});S(c)}catch(e){console.error("Error generating QR code:",e)}},A=async()=>{if(!(!s||!o)){g(!0);try{const t=document.createElement("canvas"),e=t.getContext("2d");t.width=600,t.height=800,e.fillStyle="#ffffff",e.fillRect(0,0,t.width,t.height),e.strokeStyle="#e5e7eb",e.lineWidth=1,e.strokeRect(0,0,t.width,t.height);const c=100;e.fillStyle="#000000",e.fillRect(0,0,t.width,c);const i=30;let a=40;const n=new Image;n.crossOrigin="anonymous";const j=()=>{const x=i;e.drawImage(n,x,a+5,50,50),e.fillStyle="#ffffff",e.font="600 22px Inter, sans-serif",e.textAlign="left",e.fillText("DYANPITT",x+50+15,a+25),e.font="400 14px Inter, sans-serif",e.fillText("Study Room",x+50+15,a+45),e.font="500 18px Inter, sans-serif",e.textAlign="right",e.fillText("VISITOR PASS",t.width-i,a+35),a=c+30,e.fillStyle="#000000",e.font="500 14px Inter, sans-serif",e.textAlign="left",e.fillText("Status: Confirmed",i,a);const N=new Image;N.onload=()=>{a+=40;const d=160,I=(t.width-d)/2;e.drawImage(N,I,a,d,d),a+=d+20,e.fillStyle="#6b7280",e.font="400 12px Inter, sans-serif",e.textAlign="center",e.fillText("Present this QR code at reception",t.width/2,a),a+=40;const D=a;e.fillStyle="#f8f9fa",e.fillRect(i,D,t.width-i*2,220),a+=25,e.fillStyle="#333333",e.font="600 16px Inter, sans-serif",e.textAlign="center",e.fillText("Visitor Information",t.width/2,a),a+=30;const w=[{label:"Name:",value:s.fullName||"N/A"},{label:"Email:",value:s.email||"N/A"},{label:"Contact:",value:s.phoneNumber||"N/A"},{label:"Gender:",value:s.gender?s.gender.charAt(0).toUpperCase()+s.gender.slice(1):"N/A"},{label:"Tour Date:",value:s.tourDate?new Date(s.tourDate).toLocaleDateString():"N/A"},{label:"Tour Time:",value:s.tourTime||"N/A"}];w.forEach((h,f)=>{f<w.length-1&&(e.strokeStyle="#e9ecef",e.lineWidth=1,e.beginPath(),e.moveTo(i+20,a+15),e.lineTo(t.width-i-20,a+15),e.stroke()),e.fillStyle="#666666",e.font="500 14px Inter, sans-serif",e.textAlign="left",e.fillText(h.label,i+20,a),e.fillStyle="#333333",e.font="500 14px Inter, sans-serif",e.textAlign="right",e.fillText(h.value,t.width-i-20,a),a+=30}),a+=40,e.fillStyle="#f8f9fa",e.fillRect(i,a,t.width-i*2,70),e.strokeStyle="#e5e7eb",e.lineWidth=1,e.strokeRect(i,a,t.width-i*2,70),a+=20,e.fillStyle="#333333",e.font="500 14px Inter, sans-serif",e.textAlign="center",e.fillText("Important Instructions",t.width/2,a),a+=18,e.fillStyle="#666666",e.font="400 11px Inter, sans-serif",e.fillText("Present this pass at reception â€¢ Arrive 10 minutes early",t.width/2,a),a+=12,e.fillText("Valid only for the specified date and time",t.width/2,a),a+=40,e.fillStyle="#6b7280",e.font="400 10px Inter, sans-serif",e.textAlign="center",e.fillText("Generated: "+new Date().toLocaleString(),t.width/2,a),a+=12,e.fillText("Dyanpeeth Abhyasika â€¢ Digital Visitor Pass",t.width/2,a),t.toBlob(h=>{const f=URL.createObjectURL(h),r=document.createElement("a");r.href=f,r.download=`dyanpitt-visitor-pass-${(s.fullName||"visitor").replace(/\s+/g,"-")}.png`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(f),g(!1)})},N.src=o};n.onload=j,n.onerror=()=>{console.warn("Logo failed to load, proceeding without logo"),j()},n.src="./Logo.png"}catch(t){console.error("Error downloading pass:",t),g(!1)}}};if(!s)return l.jsx("div",{className:"main-container",children:l.jsx("div",{className:"simple-loading",children:l.jsx("p",{children:"Loading visitor pass..."})})});const T=()=>{u("/")};return l.jsx("div",{className:"congratulations-container",children:l.jsxs("div",{className:"congratulations-content",children:[l.jsx("div",{className:"visitor-pass-logo",children:l.jsx("img",{src:"./Logo.png",alt:"Dyanpeeth Abhyasika Logo",className:"logo-image"})}),l.jsxs("div",{className:"visitor-details",children:[l.jsx("div",{className:"success-icon",children:l.jsx("div",{className:"success-circle",children:l.jsx("svg",{width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:l.jsx("path",{d:"M9 12L11 14L15 10",stroke:"#ffffff",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})})}),l.jsx("div",{className:"congratulations-header",children:l.jsx("h1",{className:"congratulations-title",children:"Tour Request Confirmed!"})}),l.jsx("div",{className:"qr-code-container",children:o&&l.jsx("img",{src:o,alt:"Visitor Pass QR Code",className:"qr-code-image"})}),l.jsxs("div",{className:"details-grid",children:[l.jsx("div",{className:"detail-label-cell",children:l.jsx("span",{className:"detail-label",children:"Name"})}),l.jsx("div",{className:"detail-value-cell",children:l.jsx("span",{className:"detail-value",children:s.fullName||"N/A"})}),l.jsx("div",{className:"detail-label-cell",children:l.jsx("span",{className:"detail-label",children:"Email"})}),l.jsx("div",{className:"detail-value-cell",children:l.jsx("span",{className:"detail-value",children:s.email||"N/A"})}),l.jsx("div",{className:"detail-label-cell",children:l.jsx("span",{className:"detail-label",children:"Contact"})}),l.jsx("div",{className:"detail-value-cell",children:l.jsx("span",{className:"detail-value",children:s.phoneNumber||"N/A"})}),l.jsx("div",{className:"detail-label-cell",children:l.jsx("span",{className:"detail-label",children:"Gender"})}),l.jsx("div",{className:"detail-value-cell",children:l.jsx("span",{className:"detail-value",children:s.gender?s.gender.charAt(0).toUpperCase()+s.gender.slice(1):"N/A"})}),l.jsx("div",{className:"detail-label-cell",children:l.jsx("span",{className:"detail-label",children:"Tour Date"})}),l.jsx("div",{className:"detail-value-cell",children:l.jsx("span",{className:"detail-value",children:s.tourDate?new Date(s.tourDate).toLocaleDateString():"N/A"})}),l.jsx("div",{className:"detail-label-cell",children:l.jsx("span",{className:"detail-label",children:"Tour Time"})}),l.jsx("div",{className:"detail-value-cell",children:l.jsx("span",{className:"detail-value",children:s.tourTime||"N/A"})})]}),l.jsxs("div",{className:"download-section",children:[l.jsx("button",{onClick:A,disabled:v,className:"login-button",children:v?"Generating...":"Download Pass"}),l.jsx("button",{onClick:T,className:"login-button back-to-main-button",children:"Back to Main"})]})]}),l.jsxs("div",{className:"visitor-pass-notes",children:[l.jsx("h4",{children:"ðŸ“‹ Important Notes"}),l.jsxs("ul",{children:[l.jsxs("li",{children:["It is ",l.jsx("strong",{children:"mandatory"})," to carry this pass during your visit"]}),l.jsx("li",{children:"Present this QR code at the reception for quick check-in"}),l.jsx("li",{children:"The admin will scan this code to mark your tour as complete"}),l.jsx("li",{children:"Please arrive 10 minutes before your scheduled time"})]})]})]})})}export{q as default};
