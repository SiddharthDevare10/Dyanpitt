import{j as e,u as q,a as E,d as G,b as R,r as l,c as k}from"./index-DJTMSaIU.js";import{N as U}from"./NotificationModal-CMhk9B5P.js";import{X as Y}from"./x-pkKEGEq6.js";import{C as J}from"./check-circle-GmDb2baz.js";import{A as K}from"./arrow-left-CTsakzoZ.js";import{c as I}from"./createLucideIcon-D3XSCUrN.js";const X=I("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),W=I("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function H({isOpen:r,onClose:u,onContinue:f,transactionId:t}){return r?e.jsx("div",{className:"modal-overlay",onClick:u,children:e.jsxs("div",{className:"modal-content cash-payment-success-modal",onClick:y=>y.stopPropagation(),children:[e.jsx("div",{className:"modal-header",children:e.jsx("button",{className:"modal-close",onClick:u,children:e.jsx(Y,{size:20})})}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"success-icon",children:e.jsx(J,{size:48,color:"#22c55e"})}),e.jsx("h2",{className:"modal-title",children:"Cash Payment Request Submitted!"}),e.jsx("div",{className:"transaction-id-section",children:e.jsxs("div",{className:"transaction-id-card",children:[e.jsx("span",{className:"transaction-label",children:"Transaction ID"}),e.jsx("span",{className:"transaction-value",children:t})]})}),e.jsx("p",{className:"modal-message",children:"You need to submit the cash to the respective admin and you will receive your Dyanpitt ID after payment collection."})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"login-button login-screen-submit-button",onClick:f,children:"Exit"})})]})}):null}function oe(){const r=q(),u=E(),[f]=G(),{user:t,updateUser:y}=R(),[d,g]=l.useState({isOpen:!1,type:"info",title:"",message:"",actions:[]}),[p,B]=l.useState(""),[x,P]=l.useState(!1),[S,i]=l.useState({}),[A,Q]=l.useState(""),[j,D]=l.useState(null),[V,O]=l.useState(!0),[$,C]=l.useState(!1),N=f.get("bookingId");l.useEffect(()=>{(async()=>{try{if(N){const c=await k.request(`/booking/${N}`);c.success?D(c.data):i({general:"Booking not found"})}else u.state?.bookingData?D(u.state.bookingData):i({general:"No booking data found"})}catch{i({general:"Failed to load booking data"})}finally{O(!1)}})()},[N,u.state]);const z=[{id:"upi",name:"Digital UPI Payment",icon:e.jsx(W,{size:24}),description:"Instant payment via GPay, PhonePe, Paytm, or any UPI app"},{id:"cash",name:"Cash Payment at Center",icon:e.jsx(X,{size:24}),description:"Pay cash directly to admin at Dyanpitt study center"}],F=s=>{B(s),i({})},L=async()=>{if(!p){i({payment:"Please select a payment method"});return}P(!0),i({});try{if(p==="cash"){const s=await k.request("/booking/create-cash-booking",{method:"POST",body:JSON.stringify(j)});s.success?(y({...t,bookingDetails:s.data.bookingDetails,bookingCompleted:!0}),r("/cash-payment-pending",{state:{bookingData:s.data.bookingDetails}})):i({payment:s.message||"Failed to create cash payment request"})}else{await new Promise(T=>setTimeout(T,3e3));const s=`PAY_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,c=`TXN_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,o=await k.request("/booking/create",{method:"POST",body:JSON.stringify({...j,paymentId:s,paymentMethod:p,transactionId:c,paymentStatus:"completed"})});o.success?o.dyanpittId&&!t.hasDnyanpittId?(y({...t,dyanpittId:o.dyanpittId,hasDnyanpittId:!0,showCongratulations:!0,bookingCompleted:!0,paymentCompleted:!0}),r("/congratulations")):g({isOpen:!0,type:"success",title:"Payment Successful",message:"Your payment has been completed successfully!",actions:[{label:"Go to Dashboard",variant:"primary",onClick:()=>{y({...t,bookingCompleted:!0,paymentCompleted:!0}),g({...d,isOpen:!1}),r("/dashboard")}}]}):i({payment:o.message||"Payment failed"})}}catch(s){console.error("Payment error:",s),i({payment:"Payment failed. Please try again."})}finally{P(!1)}},n=j||t?.bookingDetails,a=(()=>{if(!n)return null;t?.gender,t?.registrationDate,t?.lastPackageDate;const c=(m=>{if(!m)return"standard";const h=parseInt(m.match(/\d+$/)?.[0]||"0"),v=m.charAt(0);return n?.membershipType==="Dyandhara Kaksh"?h===5?"gold":[24,25,26,27,28,29,32,33].includes(h)?"silver":"standard":n?.membershipType==="Dyanpurn Kaksh"?v==="A"&&[54,55,56].includes(h)||v==="B"&&[63,64,65].includes(h)?"silver":v==="C"&&h===69?"gold":"standard":"standard"})(n?.preferredSeat);let o=0;o=299;const b=((m,h)=>{switch(h){case"silver":return Math.round(m*1.25);case"gold":return Math.round(m*1.5);default:return m}})(o,c),_=0,w=0,M=0;return{basePrice:o,seatTier:c,priceWithSeatTier:b,seatTierSurcharge:b-o,totalDiscount:_,discountAmount:w,registrationFee:M,finalAmount:b-w+M}})();return e.jsxs("div",{className:"main-container membership-details-adjustment",children:[e.jsx("button",{onClick:()=>r(-1),className:"back-button",disabled:x,children:e.jsx(K,{size:20,color:"white"})}),e.jsxs("div",{className:"header-section",children:[e.jsx("h1",{className:"main-title",children:"Payment"}),e.jsx("p",{className:"main-subtitle",children:"Complete your booking payment"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Booking Summary"}),e.jsx("div",{className:"booking-info",children:e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:" Preferred Time Slot"}),e.jsx("span",{className:"info-value",children:n?.timeSlot})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Membership Type"}),e.jsx("span",{className:"info-value",children:n?.membershipType})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Membership Duration"}),e.jsx("span",{className:"info-value",children:n?.membershipDuration})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Membership Start Date"}),e.jsx("span",{className:"info-value",children:n?.membershipStartDate?new Date(n.membershipStartDate).toLocaleDateString():"Not set"})]}),e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Preferred Seat"}),e.jsx("span",{className:"info-value",children:n?.preferredSeat})]})]})})]}),a&&e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Price Breakdown"}),e.jsx("div",{className:"payment-calculation",children:e.jsxs("div",{className:"info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Base Package Price"}),e.jsxs("span",{className:"info-value",children:["₹",a.basePrice]})]}),a.seatTier!=="standard"&&e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:a.seatTier==="silver"?"Silver Seat (+25%)":"Gold Seat (+50%)"}),e.jsxs("span",{className:"info-value surcharge",children:["+₹",a.seatTierSurcharge]})]}),a.totalDiscount>0&&e.jsxs("div",{className:"info-item",children:[e.jsxs("span",{className:"info-label",children:["Discount (",a.totalDiscount,"%)"]}),e.jsxs("span",{className:"info-value discount",children:["-₹",a.discountAmount]})]}),a.registrationFee>0&&e.jsxs("div",{className:"info-item",children:[e.jsx("span",{className:"info-label",children:"Registration Fee"}),e.jsxs("span",{className:"info-value",children:["₹",a.registrationFee]})]}),e.jsxs("div",{className:"info-item total-amount",children:[e.jsx("span",{className:"info-label",children:"Total Amount"}),e.jsxs("span",{className:"info-value",children:["₹",a.finalAmount]})]})]})})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"input-label",children:"Select Payment Method *"}),e.jsx("div",{className:"payment-methods-section",children:z.map(s=>e.jsxs("div",{className:`payment-method-option ${p===s.id?"selected":""}`,onClick:()=>F(s.id),children:[e.jsxs("div",{className:"payment-method-content",children:[e.jsx("div",{className:"payment-method-icon",children:s.icon}),e.jsxs("div",{className:"payment-method-details",children:[e.jsx("span",{className:"payment-method-name",children:s.name}),e.jsx("span",{className:"payment-method-desc",children:s.description})]})]}),e.jsx("div",{className:"payment-selection-indicator",children:e.jsx("div",{className:`selection-circle ${p===s.id?"selected":""}`})})]},s.id))}),S.payment&&e.jsx("span",{className:"error-message",children:S.payment})]}),e.jsx("button",{onClick:L,className:"login-button login-screen-submit-button",disabled:x||!p,children:x?e.jsxs("div",{className:"payment-processing",children:[e.jsx("div",{className:"login-screen-spinner"}),"Processing Payment..."]}):`Pay ₹${a?.finalAmount||0}`}),e.jsx(U,{isOpen:d.isOpen,onClose:()=>g({...d,isOpen:!1}),type:d.type,title:d.title,message:d.message,actions:d.actions}),e.jsx(H,{isOpen:$,onClose:()=>C(!1),onContinue:()=>{C(!1),r("/dashboard")},transactionId:A})]})}export{oe as default};
