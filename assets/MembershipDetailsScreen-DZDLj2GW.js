import{u as I,b as G,r as u,j as e,c as y}from"./index-DUV06g7s.js";import{C as S,D as W}from"./CustomDropdown-4RbRsEYj.js";import{v as H}from"./fileValidation-Bv-3PqZU.js";import{u as $}from"./formAutoSave-iZfeXlxb.js";import{A as z}from"./arrow-left-CYiC68CK.js";import{c as O}from"./createLucideIcon-BKxL3LQ9.js";import"./istUtils-Dwemw_z4.js";import"./calendar-CnpXgmGa.js";const C=O("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),k=O("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);function ee(){const D=I(),{user:l,updateUser:E,refreshUser:U}=G(),[a,v]=u.useState({visitedBefore:"",fatherName:"",parentContactNumber:"",educationalBackground:"",currentOccupation:"",jobTitle:"",examPreparation:"",examinationDate:"",selfiePhoto:null}),j=$(`membership_${l?.email||"unknown"}`,a,{excludeFields:["selfiePhoto","fatherName","parentContactNumber"],saveInterval:2e3,onSave:s=>console.log("üíæ Auto-saved membership form"),onRestore:s=>console.log("üì± Restored membership form data")}),[q,V]=u.useState(!1),[t,m]=u.useState({}),[P,b]=u.useState(!1),[A,w]=u.useState(!1),[T,F]=u.useState(!1),[f,x]=u.useState({background:!0,study:!1,personal:!1}),g=s=>{x(r=>({...r,[s]:!r[s]}))};u.useEffect(()=>{const s=t.visitedBefore||t.educationalBackground||t.currentOccupation||t.jobTitle,r=t.examPreparation||t.examinationDate,o=t.fatherName||t.parentContactNumber||t.selfiePhoto,i=h("background"),c=h("study");s&&x(n=>({...n,background:!0})),r&&x(n=>({...n,study:!0})),o&&x(n=>({...n,personal:!0})),i&&!s&&!r&&x(n=>({...n,background:!1,study:!0})),c&&!r&&!o&&x(n=>({...n,study:!1,personal:!0}))},[t,a]);const h=s=>{switch(s){case"background":const r=a.currentOccupation==="Unemployed"||a.currentOccupation==="Student"||a.jobTitle&&a.jobTitle.trim();return a.visitedBefore&&a.educationalBackground&&a.currentOccupation&&r&&!t.visitedBefore&&!t.educationalBackground&&!t.currentOccupation&&!t.jobTitle;case"personal":return a.fatherName&&a.fatherName.trim()&&a.parentContactNumber&&a.parentContactNumber.trim()&&a.selfiePhoto&&!t.fatherName&&!t.parentContactNumber&&!t.selfiePhoto;case"study":return a.examPreparation&&a.examinationDate&&!t.examPreparation&&!t.examinationDate;default:return!1}};u.useEffect(()=>{(async()=>{if(l?.email)try{j.clearSavedData()}catch(r){console.error("Error fetching membership data:",r)}})()},[l?.email]),u.useEffect(()=>{l?.email&&Object.keys(a).some(s=>a[s])&&j.scheduleAutoSave()},[a,l?.email]),u.useEffect(()=>{(async()=>{if(!T)try{F(!0),await B(l?.email)}catch(r){console.error("Error auto-checking tour data:",r)}})()},[T,l?.email]);const d=async s=>{const{name:r,value:o,type:i,files:c}=s.target;if(i==="file"){const n=c[0];if(n){const p=H(n,"SELFIE");if(!p.isValid){m(N=>({...N,[r]:p.error})),s.target.value="";return}m(N=>({...N,[r]:""}))}v(p=>({...p,[r]:n}))}else v(n=>{const p={...n,[r]:o};return r==="currentOccupation"&&(o==="Unemployed"||o==="Student")&&(p.jobTitle=""),p}),r==="visitedBefore"&&o==="yes"&&l?.email&&await B(l.email);t[r]&&m(n=>({...n,[r]:""})),r==="currentOccupation"&&(o==="Unemployed"||o==="Student")&&t.jobTitle&&m(n=>({...n,jobTitle:""}))},B=async s=>{try{b(!0);let r=s;if(!r&&(r=l?.email,r||(console.log("User email not available, refreshing from API..."),await U(),r=l?.email),!r))try{const i=await y.getCurrentUser();i.success&&i.user?.email&&(r=i.user.email)}catch{}if(!r)return;let o;try{o=await y.request(`/tour/requests/${encodeURIComponent(r)}`)}catch{return}if(!o||!o.success)return;if(o.success&&o.data&&o.data.length>0){const i=o.data[0];v(c=>({...c,educationalBackground:c.educationalBackground||i.educationalBackground||"",currentOccupation:c.currentOccupation||i.currentOccupation||"",jobTitle:c.jobTitle||i.jobTitle||"",examPreparation:c.examPreparation||i.examPreparation||"",examinationDate:c.examinationDate||(i.examinationDate?i.examinationDate.split("T")[0]:""),visitedBefore:c.visitedBefore||"yes"})),w(!0),setTimeout(()=>{w(!1)},5e3),console.log("‚úÖ Pre-populated membership form with tour data:",{email:r,educationalBackground:i.educationalBackground,currentOccupation:i.currentOccupation,jobTitle:i.jobTitle,examPreparation:i.examPreparation,examinationDate:i.examinationDate})}}catch(r){console.error("Error fetching tour data:",r)}finally{b(!1)}},M=()=>{const s={};if(a.visitedBefore||(s.visitedBefore="Please select an option"),a.fatherName.trim()||(s.fatherName="Father's name is required"),a.parentContactNumber.trim()||(s.parentContactNumber="Parent's contact number is required"),a.educationalBackground||(s.educationalBackground="Educational background is required"),a.currentOccupation||(s.currentOccupation="Current occupation is required"),!a.jobTitle.trim()&&a.currentOccupation!=="Unemployed"&&a.currentOccupation!=="Student"&&(s.jobTitle="Job title is required"),a.examPreparation||(s.examPreparation="Please select an exam you are preparing for"),!a.examinationDate)s.examinationDate="Examination date is required";else{const r=new Date(a.examinationDate),o=new Date;o.setDate(o.getDate()+1),o.setHours(0,0,0,0),r<o&&(s.examinationDate="Please select a future examination date (tomorrow or later)")}return a.selfiePhoto||(s.selfiePhoto="Please upload a selfie photo"),m(s),Object.keys(s).length===0},R=async s=>{if(s.preventDefault(),M()){b(!0);try{const r=await y.updateMembershipDetails(a);if(r.success){j.clearSavedData();const o={...r.user,membershipCompleted:!0};E(o),console.log("‚úÖ Membership details saved to database successfully"),D("/booking")}else m({submit:r.message||"Failed to save membership details to database"})}catch(r){console.error("‚ùå Failed to save membership details:",r),r.message.includes("Network error")||r.message.includes("Failed to fetch")?m({submit:"Network error. Please check your connection and try again."}):r.message.includes("401")||r.message.includes("unauthorized")?m({submit:"Session expired. Please log in again."}):m({submit:r.message||"Failed to save membership details. Please try again."})}finally{b(!1)}}};return e.jsxs("div",{className:"main-container membership-details-adjustment",children:[e.jsx("button",{onClick:()=>D(-1),className:"back-button",children:e.jsx(z,{size:20,color:"white"})}),e.jsxs("div",{className:"header-section",children:[e.jsx("h1",{className:"main-title",children:"Membership Details"}),e.jsx("p",{className:"main-subtitle",children:"Fill in your details to complete registration"})]}),e.jsxs("form",{onSubmit:R,autoComplete:"off",noValidate:!0,children:[e.jsxs("div",{className:"accordion-section",children:[e.jsxs("div",{className:`accordion-header ${h("background")?"completed":""}`,onClick:()=>g("background"),children:[e.jsxs("div",{className:"accordion-title-wrapper",children:[e.jsx("h3",{className:"accordion-title",children:"Background Information"}),h("background")&&e.jsx("div",{className:"completion-indicator",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 12l2 2 4-4"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"})]})})]}),e.jsx("div",{className:"accordion-chevron",children:f.background?e.jsx(k,{size:20}):e.jsx(C,{size:20})})]}),f.background&&e.jsxs("div",{className:"accordion-content",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"membership-input-label",children:"Have you visited Dnyanpeeth Abhyasika before and filled out our form?"}),e.jsx("div",{className:"marathi-text",children:"‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§Ø‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡•Ä ‡§ú‡•ç‡§û‡§æ‡§®‡§™‡•Ä‡§† ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏‡§ø‡§ï‡•á‡§≤‡§æ ‡§≠‡•á‡§ü ‡§¶‡•á‡§ä‡§® ‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡§≤‡§æ ‡§Ü‡§π‡•á ‡§ï‡§æ?"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",name:"visitedBefore",value:"yes",checked:a.visitedBefore==="yes",onChange:d}),e.jsx("span",{className:"radio-custom"}),"Yes"]}),e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",name:"visitedBefore",value:"no",checked:a.visitedBefore==="no",onChange:d}),e.jsx("span",{className:"radio-custom"}),"No"]})]}),A&&e.jsxs("div",{className:"tour-data-indicator membership-details-tour-indicator",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 12l2 2 4-4"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"})]}),"Great! We found you visited Dyanpitt for a tour and pre-populated some fields from the Tour Details."]}),t.visitedBefore&&e.jsx("span",{className:"error-message",children:t.visitedBefore})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"membership-input-label",children:"What is your educational background?"}),e.jsx("div",{className:"marathi-text",children:"‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§∂‡•à‡§ï‡•ç‡§∑‡§£‡§ø‡§ï ‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ ‡§®‡§ø‡§µ‡§°‡§æ."}),e.jsx(S,{name:"educationalBackground",value:a.educationalBackground,onChange:d,options:[{value:"High School",label:"High School"},{value:"Graduation",label:"Graduation"},{value:"Post Graduation",label:"Post Graduation"},{value:"Doctorate Degree",label:"Doctorate Degree"},{value:"Technical or Vocational School",label:"Technical or Vocational School"},{value:"Other",label:"Other"}],placeholder:"Select your educational background",className:"form-input",error:t.educationalBackground}),t.educationalBackground&&e.jsx("span",{className:"error-message",children:t.educationalBackground})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"membership-input-label",children:"What is your current occupation?"}),e.jsx("div",{className:"marathi-text",children:"‡§§‡•Å‡§Æ‡§ö‡§æ ‡§∏‡§ß‡•ç‡§Ø‡§æ‡§ö‡§æ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø ‡§®‡§ø‡§µ‡§°‡§æ."}),e.jsx(S,{name:"currentOccupation",value:a.currentOccupation,onChange:d,options:[{value:"Student",label:"Student"},{value:"Employed",label:"Employed"},{value:"Self-employed",label:"Self-employed"},{value:"Unemployed",label:"Unemployed"},{value:"Retired",label:"Retired"},{value:"Other",label:"Other"}],placeholder:"Select your current occupation",className:"form-input",error:t.currentOccupation}),t.currentOccupation&&e.jsx("span",{className:"error-message",children:t.currentOccupation})]}),e.jsxs("div",{className:"input-group",children:[e.jsxs("label",{className:"membership-input-label",children:["What is your job title?",(a.currentOccupation==="Unemployed"||a.currentOccupation==="Student")&&e.jsx("span",{className:"optional-text",children:" (Not applicable)"})]}),e.jsx("div",{className:"marathi-text",children:"‡§§‡•Å‡§Æ‡§ö‡§æ ‡§π‡•Å‡§¶‡•ç‡§¶‡§æ ‡§Ø‡•á‡§•‡•á ‡§≤‡§ø‡§π‡§æ."}),e.jsx("input",{type:"text",name:"jobTitle",placeholder:a.currentOccupation==="Unemployed"||a.currentOccupation==="Student"?"Not applicable for your occupation":"Enter your job title",value:a.jobTitle,onChange:d,disabled:a.currentOccupation==="Unemployed"||a.currentOccupation==="Student",className:`form-input ${t.jobTitle?"input-error":""} ${a.currentOccupation==="Unemployed"||a.currentOccupation==="Student"?"disabled":""}`}),t.jobTitle&&e.jsx("span",{className:"error-message",children:t.jobTitle})]})]})]}),e.jsxs("div",{className:"accordion-section",children:[e.jsxs("div",{className:`accordion-header ${h("study")?"completed":""}`,onClick:()=>g("study"),children:[e.jsxs("div",{className:"accordion-title-wrapper",children:[e.jsx("h3",{className:"accordion-title",children:"Study Goals & Documentation"}),h("study")&&e.jsx("div",{className:"completion-indicator",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 12l2 2 4-4"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"})]})})]}),e.jsx("div",{className:"accordion-chevron",children:f.study?e.jsx(k,{size:20}):e.jsx(C,{size:20})})]}),f.study&&e.jsxs("div",{className:"accordion-content",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"membership-input-label",children:"What specific exam are you preparing for by using the study room facilities?"}),e.jsx("div",{className:"marathi-text",children:"‡§ï‡•ã‡§£‡§§‡•ç‡§Ø‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡•á‡§ö‡•ç‡§Ø‡§æ ‡§§‡§Ø‡§æ‡§∞‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏‡§ø‡§ï‡•á‡§ö‡§æ ‡§µ‡§æ‡§™‡§∞ ‡§ï‡§∞‡§£‡§æ‡§∞ ‡§Ü‡§π‡§æ‡§§?"}),e.jsx(S,{name:"examPreparation",value:a.examPreparation,onChange:d,options:[{value:"MPSC",label:"MPSC"},{value:"UPSC",label:"UPSC"},{value:"Saral Seva",label:"Saral Seva"},{value:"Railway",label:"Railway"},{value:"SSC (Staff)",label:"SSC (Staff)"},{value:"NOR-CET",label:"NOR-CET"},{value:"Police Bharti",label:"Police Bharti"},{value:"SRPF",label:"SRPF"},{value:"CRPF",label:"CRPF"},{value:"Army-GD",label:"Army-GD"},{value:"Army-NA",label:"Army-NA"},{value:"SSC (10th)",label:"SSC (10th)"},{value:"HSC (12th)",label:"HSC (12th)"},{value:"JEE",label:"JEE"},{value:"NEET",label:"NEET"},{value:"MHT-CET",label:"MHT-CET"},{value:"UG",label:"UG"},{value:"PG",label:"PG"},{value:"PHD",label:"PHD"},{value:"MCR",label:"MCR"},{value:"CDS",label:"CDS"},{value:"DMER",label:"DMER"},{value:"Banking",label:"Banking"},{value:"Any Other",label:"Any Other"}],placeholder:"Choose an option",className:"form-input",error:t.examPreparation}),t.examPreparation&&e.jsx("span",{className:"error-message",children:t.examPreparation})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"membership-input-label",children:"What is the tentative date of your examination?"}),e.jsx("div",{className:"marathi-text",children:"‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡•á‡§ö‡•Ä ‡§Ö‡§Ç‡§¶‡§æ‡§ú‡•á ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§Ø‡•á‡§•‡•á ‡§≤‡§ø‡§π‡§æ."}),e.jsx(W,{name:"examinationDate",value:a.examinationDate,onChange:d,className:t.examinationDate?"input-error":"",error:!!t.examinationDate,min:new Date(Date.now()+1440*60*1e3).toISOString().split("T")[0],placeholder:"e.g., August 15, 2024"}),t.examinationDate&&e.jsx("span",{className:"error-message",children:t.examinationDate})]})]})]}),e.jsxs("div",{className:"accordion-section",children:[e.jsxs("div",{className:`accordion-header ${h("personal")?"completed":""}`,onClick:()=>g("personal"),children:[e.jsxs("div",{className:"accordion-title-wrapper",children:[e.jsx("h3",{className:"accordion-title",children:"Personal & Contact Details"}),h("personal")&&e.jsx("div",{className:"completion-indicator",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 12l2 2 4-4"}),e.jsx("circle",{cx:"12",cy:"12",r:"9"})]})})]}),e.jsx("div",{className:"accordion-chevron",children:f.personal?e.jsx(k,{size:20}):e.jsx(C,{size:20})})]}),f.personal&&e.jsxs("div",{className:"accordion-content",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"membership-input-label",children:"What is your father's name?"}),e.jsx("div",{className:"marathi-text",children:"‡§µ‡§°‡§ø‡§≤‡§æ‡§Ç‡§ö‡•á ‡§®‡§æ‡§µ ‡§Ø‡•á‡§•‡•á ‡§ü‡§æ‡§ï‡§æ."}),e.jsx("input",{type:"text",name:"fatherName",placeholder:"Enter your father's name",value:a.fatherName,onChange:d,className:`form-input ${t.fatherName?"input-error":""}`,autoComplete:"off",autofill:"off","data-form-type":"other"}),t.fatherName&&e.jsx("span",{className:"error-message",children:t.fatherName})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"membership-input-label",children:"Parent's contact number?"}),e.jsx("div",{className:"marathi-text",children:"‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§™‡§æ‡§≤‡§ï‡§æ‡§Ç‡§ö‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§Ø‡•á‡§•‡•á ‡§≤‡§ø‡§π‡§æ."}),e.jsx("input",{type:"tel",name:"parentContactNumber",placeholder:"Enter parent's contact number",value:a.parentContactNumber,onChange:d,className:`form-input ${t.parentContactNumber?"input-error":""}`,autoComplete:"off",autofill:"off","data-form-type":"other"}),t.parentContactNumber&&e.jsx("span",{className:"error-message",children:t.parentContactNumber})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{className:"membership-input-label",children:"Please upload a selfie photo here. *"}),e.jsx("div",{className:"marathi-text",children:"‡§∏‡•ç‡§µ‡§§‡§É‡§ö‡§æ ‡§´‡•ã‡§ü‡•ã ‡§Ø‡•á‡§•‡•á ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ. (‡§´‡•ç‡§∞‡§Ç‡§ü ‡§ï‡•Ö‡§Æ‡•á‡§∞‡§æ ‡§µ‡§æ‡§™‡§∞‡§æ)"}),e.jsxs("div",{className:"file-upload-container",children:[e.jsx("input",{type:"file",name:"selfiePhoto",accept:"image/*",capture:"user",onChange:d,className:"file-input-hidden",id:"selfiePhoto"}),e.jsxs("label",{htmlFor:"selfiePhoto",className:`file-upload-button ${t.selfiePhoto?"input-error":""}`,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),e.jsx("circle",{cx:"12",cy:"13",r:"4"})]}),a.selfiePhoto?"Change Selfie":"Take Selfie Photo"]}),a.selfiePhoto&&e.jsx("div",{className:"file-preview",children:e.jsxs("span",{className:"file-name",children:["üì∑ ",a.selfiePhoto.name]})})]}),t.selfiePhoto&&e.jsx("span",{className:"error-message",children:t.selfiePhoto})]})]})]}),t.submit&&e.jsx("div",{className:"error-message",children:t.submit}),e.jsx("button",{type:"submit",className:"login-button",disabled:P,children:P?"Saving...":"Continue"})]})]})}export{ee as default};
