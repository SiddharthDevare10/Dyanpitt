import{j as e,u as E,a as L,d as Y,b as U,r,c as y}from"./index-DUV06g7s.js";import{N as R}from"./NotificationModal-E5RM_EBB.js";import{X as G}from"./x-BehD0eNY.js";import{C as J}from"./check-circle-DTBhf4ZR.js";import{a as K}from"./istUtils-Dwemw_z4.js";import{A as X}from"./arrow-left-CYiC68CK.js";import{c as T}from"./createLucideIcon-BKxL3LQ9.js";const W=T("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),H=T("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function Q({isOpen:c,onClose:p,onContinue:x,transactionId:t}){return c?e.jsx("div",{className:"modal-overlay",onClick:p,children:e.jsxs("div",{className:"modal-content cash-payment-success-modal",onClick:g=>g.stopPropagation(),children:[e.jsx("div",{className:"modal-header",children:e.jsx("button",{className:"modal-close",onClick:p,children:e.jsx(G,{size:20})})}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"success-icon",children:e.jsx(J,{size:48,color:"#22c55e"})}),e.jsx("h2",{className:"modal-title",children:"Cash Payment Request Submitted!"}),e.jsx("div",{className:"transaction-id-section",children:e.jsxs("div",{className:"transaction-id-card",children:[e.jsx("span",{className:"transaction-label",children:"Transaction ID"}),e.jsx("span",{className:"transaction-value",children:t})]})}),e.jsx("p",{className:"modal-message",children:"You need to submit the cash to the respective admin and you will receive your Dyanpitt ID after payment collection."})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"login-button login-screen-submit-button",onClick:x,children:"Exit"})})]})}):null}function le(){const c=E(),p=L(),[x]=Y(),{user:t,updateUser:g}=U(),[h,A]=r.useState({isOpen:!1,type:"info",title:"",message:"",actions:[]}),[u,M]=r.useState(""),[k,N]=r.useState(!1),[P,i]=r.useState({}),[B,V]=r.useState(""),[b,S]=r.useState(null),[Z,$]=r.useState(!0),[O,w]=r.useState(!1),j=x.get("bookingId");r.useEffect(()=>{(async()=>{try{if(j){const l=await y.request(`/booking/${j}`);l.success?S(l.data):i({general:"Booking not found"})}else p.state?.bookingData?S(p.state.bookingData):i({general:"No booking data found"})}catch{i({general:"Failed to load booking data"})}finally{$(!1)}})()},[j,p.state]);const z=[{id:"upi",name:"Digital UPI Payment",icon:e.jsx(H,{size:24}),description:"Instant payment via GPay, PhonePe, Paytm, or any UPI app"},{id:"cash",name:"Cash Payment at Center",icon:e.jsx(W,{size:24}),description:"Pay cash directly to admin at Dyanpitt study center"}],F=a=>{M(a),i({})},_=async()=>{if(!u){i({payment:"Please select a payment method"});return}N(!0),i({});try{if(u==="cash"){if(console.log("ðŸ” Debug Authentication State:"),console.log("User authenticated:",!!t),console.log("API service authenticated:",y.isAuthenticated()),console.log("Token exists:",!!y.getToken()),!t||!y.isAuthenticated()){i({payment:"You are not logged in. Please log in again."}),N(!1);return}const a=await y.request("/booking/create-cash-booking",{method:"POST",body:JSON.stringify(b)});a.success?(g({...t,bookingDetails:a.data.bookingDetails,bookingCompleted:!0}),c("/cash-payment-pending",{state:{bookingData:a.data.bookingDetails}})):i({payment:a.message||"Failed to create cash payment request"})}else{await new Promise(D=>setTimeout(D,3e3));const a=`PAY_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,l=`TXN_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s=await y.request("/booking/complete-payment",{method:"POST",body:JSON.stringify({bookingData:{...b,totalAmount:b.totalAmount||0},paymentId:a,paymentMethod:u,transactionId:l,paymentStatus:"completed"})});s.success?s.data.dyanpittId&&!t.hasDnyanpittId?(g({...t,dyanpittId:s.data.dyanpittId,hasDnyanpittId:!0,showCongratulations:!0,bookingCompleted:!0,paymentCompleted:!0,bookingDetails:s.data.booking}),c("/congratulations",{state:{fromPayment:!0,bookingDetails:s.data.booking,transactionId:s.data.transactionId||`PAY-${Date.now()}`,dyanpittId:s.data.dyanpittId}})):(g({...t,bookingCompleted:!0,paymentCompleted:!0,bookingDetails:s.data.booking}),c("/congratulations",{state:{fromPayment:!0,bookingDetails:s.data.booking,transactionId:s.data.transactionId||`PAY-${Date.now()}`,dyanpittId:t.dyanpittId}})):i({payment:s.message||"Payment failed"})}}catch(a){console.error("Payment error:",a),i({payment:"Payment failed. Please try again."})}finally{N(!1)}},o=b||t?.bookingDetails,n=(()=>{if(!o)return null;t?.gender,t?.registrationDate,t?.lastPackageDate;const l=(d=>{if(!d)return"standard";const m=parseInt(d.match(/\d+$/)?.[0]||"0"),v=d.charAt(0);return o?.membershipType==="Dyandhara Kaksh"?m===5?"gold":[24,25,26,27,28,29,32,33].includes(m)?"silver":"standard":o?.membershipType==="Dyanpurn Kaksh"?v==="A"&&[54,55,56].includes(m)||v==="B"&&[63,64,65].includes(m)?"silver":v==="C"&&m===69?"gold":"standard":"standard"})(o?.preferredSeat);let s=0;s=299;const f=((d,m)=>{switch(m){case"silver":return Math.round(d*1.25);case"gold":return Math.round(d*1.5);default:return d}})(s,l),q=0,I=0,C=0;return{basePrice:s,seatTier:l,priceWithSeatTier:f,seatTierSurcharge:f-s,totalDiscount:q,discountAmount:I,registrationFee:C,finalAmount:f-I+C}})();return e.jsxs("div",{className:"main-container membership-details-adjustment payment-page-container",children:[e.jsx("button",{onClick:()=>c(-1),className:"back-button",disabled:k,children:e.jsx(X,{size:20,color:"white"})}),e.jsxs("div",{className:"header-section",children:[e.jsx("h1",{className:"main-title",children:"Payment"}),e.jsx("p",{className:"main-subtitle",children:"Complete your booking payment"})]}),e.jsxs("div",{className:"booking-summary",children:[e.jsx("h3",{className:"payment-section-header",children:"Booking Summary"}),e.jsxs("div",{className:"payment-details-grid",children:[e.jsxs("div",{className:"payment-detail-row",children:[e.jsx("span",{className:"payment-detail-label",children:"Time Slot"}),e.jsx("span",{className:"payment-detail-value",children:o?.timeSlot||"Not selected"})]}),e.jsxs("div",{className:"payment-detail-row",children:[e.jsx("span",{className:"payment-detail-label",children:"Membership Type"}),e.jsx("span",{className:"payment-detail-value",children:o?.membershipType||"Not specified"})]}),e.jsxs("div",{className:"payment-detail-row",children:[e.jsx("span",{className:"payment-detail-label",children:"Duration"}),e.jsx("span",{className:"payment-detail-value",children:o?.membershipDuration||"Not specified"})]}),e.jsxs("div",{className:"payment-detail-row",children:[e.jsx("span",{className:"payment-detail-label",children:"Start Date"}),e.jsx("span",{className:"payment-detail-value",children:K(o?.membershipStartDate)||"Not set"})]}),e.jsxs("div",{className:"payment-detail-row",children:[e.jsx("span",{className:"payment-detail-label",children:"Seat"}),e.jsx("span",{className:"payment-detail-value",children:o?.preferredSeat||"Not selected"})]})]})]}),n&&e.jsxs("div",{className:"price-breakdown-summary",children:[e.jsx("h3",{className:"payment-section-header",children:"Price Breakdown"}),e.jsxs("div",{className:"breakdown-details",children:[e.jsxs("div",{className:"breakdown-item",children:[e.jsx("span",{className:"breakdown-label",children:"Base Package Price"}),e.jsxs("span",{className:"breakdown-value",children:["â‚¹",n.basePrice]})]}),n.seatTier!=="standard"&&e.jsxs("div",{className:"breakdown-item",children:[e.jsx("span",{className:"breakdown-label",children:n.seatTier==="silver"?"Silver Seat (+25%)":"Gold Seat (+50%)"}),e.jsxs("span",{className:"breakdown-value surcharge",children:["+â‚¹",n.seatTierSurcharge]})]}),n.totalDiscount>0&&e.jsxs("div",{className:"breakdown-item discount",children:[e.jsxs("span",{className:"breakdown-label",children:["Discount (",n.totalDiscount,"%)"]}),e.jsxs("span",{className:"breakdown-value",children:["-â‚¹",n.discountAmount]})]}),n.registrationFee>0&&e.jsxs("div",{className:"breakdown-item",children:[e.jsx("span",{className:"breakdown-label",children:"Registration Fee"}),e.jsxs("span",{className:"breakdown-value",children:["â‚¹",n.registrationFee]})]}),e.jsxs("div",{className:"breakdown-item total",children:[e.jsx("span",{className:"breakdown-label",children:"Total Amount"}),e.jsxs("span",{className:"breakdown-value",children:["â‚¹",n.finalAmount]})]})]})]}),e.jsxs("div",{className:"payment-methods",children:[e.jsx("h3",{className:"payment-section-header",children:"Select Payment Method *"}),e.jsx("div",{className:"payment-options",children:z.map(a=>e.jsxs("div",{className:`payment-option ${u===a.id?"selected":""}`,onClick:()=>F(a.id),children:[e.jsx("div",{className:"payment-icon",children:a.icon}),e.jsxs("div",{className:"payment-details",children:[e.jsx("h4",{children:a.name}),e.jsx("p",{children:a.description})]}),e.jsx("div",{className:"payment-radio",children:e.jsx("div",{className:`radio-custom ${u===a.id?"checked":""}`})})]},a.id))}),P.payment&&e.jsx("span",{className:"error-message",children:P.payment})]}),e.jsx("button",{onClick:_,className:"payment-button",disabled:k||!u,children:k?e.jsxs("div",{className:"processing-payment",children:[e.jsx("div",{className:"payment-spinner"}),"Processing Payment..."]}):`Pay â‚¹${n?.finalAmount||0}`}),e.jsx(R,{isOpen:h.isOpen,onClose:()=>A({...h,isOpen:!1}),type:h.type,title:h.title,message:h.message,actions:h.actions}),e.jsx(Q,{isOpen:O,onClose:()=>w(!1),onContinue:()=>{w(!1),c("/dashboard")},transactionId:B})]})}export{le as default};
