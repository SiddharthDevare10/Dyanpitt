import{u as W,a as A,b as T,r,j as e,c as P}from"./index-DUV06g7s.js";import{f as N}from"./istUtils-Dwemw_z4.js";import{C as j}from"./check-circle-DTBhf4ZR.js";import{c as x}from"./createLucideIcon-BKxL3LQ9.js";import{A as E}from"./arrow-right-Bjza2st6.js";const R=x("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),L=x("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),S=x("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);function q(){const c=W(),g=A(),{user:d,logout:k}=T(),[t,v]=r.useState(null),[C,B]=r.useState(!0),[p,y]=r.useState(null),[o,f]=r.useState(!1),[_,z]=r.useState("cash_pending"),[a,D]=r.useState(!1);r.useEffect(()=>{let n=g.state?.bookingData;if(!n&&d?.bookings&&(n=d.bookings.find(l=>l.paymentStatus==="cash_pending")),!n){c("/dashboard");return}v(n),z(n.paymentStatus||"cash_pending"),D(n.paymentStatus==="cash_collected"),B(!1)},[g.state,d,c]),r.useEffect(()=>{if(!t)return;const n=t.bookedAt?new Date(t.bookedAt):new Date,l=new Date(n.getTime()+2880*60*1e3);console.log("üîß Timer Debug:",{bookedAt:n.toISOString(),deadline:l.toISOString(),hoursFromBooking:(l.getTime()-n.getTime())/(1e3*60*60)});const s=()=>{const m=new Date,b=l.getTime()-m.getTime();if(b<=0)f(!0),y(null);else{f(!1);const w=N(b);y(w)}};s();const i=setInterval(s,1e3);return()=>clearInterval(i)},[t]),r.useEffect(()=>{if(!t||a||o)return;const n=async()=>{try{const s=await P.request("/auth/me");if(s.success&&s.user&&s.user.bookings){const i=s.user.bookings.find(m=>m._id===t._id||m.paymentStatus==="cash_collected");if(console.log("üîç Current booking from API:",i),i&&i.paymentStatus==="cash_collected"){console.log("‚úÖ Payment confirmed by admin! Redirecting to congratulations..."),c("/congratulations",{state:{fromCashPayment:!0,bookingData:i,dyanpittId:s.user.dyanpittId,membershipDetails:{membershipType:i.membershipType,timeSlot:i.timeSlot,membershipDuration:i.membershipDuration,membershipStartDate:i.membershipStartDate,membershipEndDate:i.membershipEndDate}}});return}}}catch(s){console.error("Error checking payment status:",s)}};n();const l=setInterval(n,15e3);return()=>clearInterval(l)},[t,a,o]);const u=async()=>{try{await k(),c("/login")}catch(n){console.error("Logout error:",n),c("/login")}},I=()=>{c("/congratulations",{state:{bookingData:t,transactionId:t.transactionId||t.paymentId,dyanpittId:d?.dyanpittId||"DA2024001",fromPayment:!0}})},h=n=>{if(!n)return"Not specified";try{return new Date(n).toLocaleDateString("en-IN",{timeZone:"Asia/Kolkata",year:"numeric",month:"long",day:"numeric"})}catch{return"Invalid date"}};return C?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading your booking details..."})]})}):e.jsxs("div",{className:"main-container cash-payment-pending-container",children:[e.jsxs("div",{className:"header-section",children:[e.jsx("div",{style:{textAlign:"center",marginBottom:"20px"},children:a?e.jsx(j,{size:60,color:"#10b981",style:{margin:"0 auto 16px"}}):o?e.jsx(R,{size:60,color:"#ef4444",style:{margin:"0 auto 16px"}}):e.jsx(L,{size:60,color:"#5B5B5B",style:{margin:"0 auto 16px"}})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:"600",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.025em"},children:"Payment Status:"}),e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:a?"#10b981":o?"#ef4444":"#5B5B5B",marginTop:"4px"},children:a?"Collected":o?"Expired":"Pending"})]}),a?e.jsx("h1",{className:"main-title",style:{textAlign:"center"},children:"Payment Successful!"}):e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:"600",color:o?"#dc2626":"#000000",fontFamily:"monospace",letterSpacing:"2px",marginBottom:"8px"},children:o?"00:00:00":p?`${p.hours.toString().padStart(2,"0")}:${p.minutes.toString().padStart(2,"0")}:${p.seconds.toString().padStart(2,"0")}`:"48:00:00"}),e.jsx("div",{style:{fontSize:"12px",color:o?"#dc2626":"#92400e",fontWeight:"600"},children:o?"Payment Deadline Expired":"Payment Deadline Remaining"})]}),e.jsx("p",{className:"main-subtitle",style:{textAlign:"center"},children:a?"üéâ Congratulations! Your cash payment has been successfully collected at our center. Your membership is now active!":o?"Your booking has expired. Please create a new booking.":"Your booking is confirmed! Please visit our center during payment counter hours (9:00 AM - 8:00 PM) to complete your cash payment."}),o&&e.jsxs("div",{style:{marginTop:"20px",padding:"16px",backgroundColor:"#fef2f2",border:"1px solid #ef4444",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",color:"#dc2626",marginBottom:"8px"},children:"‚ö†Ô∏è Booking Expired"}),e.jsx("p",{style:{fontSize:"14px",color:"#dc2626"},children:"Your 48-hour payment window has expired. Please create a new booking."})]})]}),e.jsxs("div",{style:{backgroundColor:"#ffffff",border:"1px solid #dddddd",borderRadius:"8px",padding:"20px",marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px",fontSize:"16px",fontWeight:"600",color:"#000000"},children:[e.jsx(j,{size:20,color:"#10b981",style:{marginRight:"8px"}}),"Booking Summary"]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingBottom:"8px",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280",fontWeight:"500"},children:"Transaction ID:"}),e.jsx("span",{style:{fontSize:"14px",color:"#000000",fontWeight:"600",fontFamily:"monospace",backgroundColor:"#f3f4f6",padding:"2px 6px",borderRadius:"4px"},children:t.transactionId||t.paymentId||"N/A"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingBottom:"8px",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280",fontWeight:"500"},children:"Membership Type:"}),e.jsx("span",{style:{fontSize:"14px",color:"#000000",fontWeight:"600"},children:t.membershipType})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingBottom:"8px",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280",fontWeight:"500"},children:"Duration:"}),e.jsx("span",{style:{fontSize:"14px",color:"#000000",fontWeight:"600"},children:t.membershipDuration})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingBottom:"8px",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280",fontWeight:"500"},children:"Time Slot:"}),e.jsx("span",{style:{fontSize:"14px",color:"#000000",fontWeight:"600"},children:t.timeSlot})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingBottom:"8px",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280",fontWeight:"500"},children:"Start Date:"}),e.jsx("span",{style:{fontSize:"14px",color:"#000000",fontWeight:"600"},children:h(t.membershipStartDate)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingBottom:"8px",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280",fontWeight:"500"},children:"End Date:"}),e.jsx("span",{style:{fontSize:"14px",color:"#000000",fontWeight:"600"},children:h(t.membershipEndDate)})]}),t.preferredSeat&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingBottom:"8px",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280",fontWeight:"500"},children:"Preferred Seat:"}),e.jsx("span",{style:{fontSize:"14px",color:"#000000",fontWeight:"600"},children:t.preferredSeat})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",backgroundColor:"#f0fdf4",borderRadius:"8px",padding:"12px",marginTop:"8px"},children:[e.jsx("span",{style:{fontSize:"16px",color:"#065f46",fontWeight:"600"},children:"Total Amount:"}),e.jsxs("span",{style:{fontSize:"18px",color:"#000000",fontWeight:"600"},children:["‚Çπ",t.totalAmount]})]})]})]}),e.jsx("div",{style:{textAlign:"center"},children:a?e.jsxs("button",{onClick:I,className:"login-button",style:{backgroundColor:"#10b981",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"600"},children:[e.jsx(E,{size:16,style:{marginRight:"8px"}}),"Next"]}):o?e.jsxs("button",{onClick:u,className:"login-button",style:{backgroundColor:"#dc2626",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(S,{size:16,style:{marginRight:"8px"}}),"Back to Login"]}):e.jsxs("button",{onClick:u,className:"login-button",style:{display:"inline-flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(S,{size:16,style:{marginRight:"8px"}}),"Back to Login"]})})]})}export{q as default};
