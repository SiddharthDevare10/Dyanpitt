import{u as M,a as W,b as $,r as l,j as s,L as K}from"./index-DJTMSaIU.js";import{E as T,a as q}from"./eye-D6RneIdP.js";import"./createLucideIcon-D3XSCUrN.js";function H(){const t=M(),N=W(),{login:E}=$(),[d,L]=l.useState(""),[m,D]=l.useState(""),[h,S]=l.useState(!1),[b,A]=l.useState(!1),[i,x]=l.useState(!1),[n,o]=l.useState({}),[y,k]=l.useState({});l.useEffect(()=>{new URLSearchParams(window.location.search).get("token")&&(window.history.replaceState({},document.title,window.location.pathname),t("/dashboard"))},[t]);const p=e=>{const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,a=/^@DA\d{9}$/;return e?e.trim().length===0?"Please enter your email address or Dyanpeeth Abhyasika ID":e.startsWith("@DA")?a.test(e)?"":"Invalid Dyanpeeth Abhyasika ID format. Should be @DA followed by 9 digits (e.g., @DA202507001)":e.includes("@")?r.test(e)?e.length>254?"Email address is too long (maximum 254 characters)":"":"Please enter a valid email address (e.g., user@example.com)":"Please enter a valid email address or Dyanpeeth Abhyasika ID (starts with @DA)":"Email address or Dyanpeeth Abhyasika ID is required"},f=e=>e?e.length<6?"Password must be at least 6 characters long":"":"Password is required",C=e=>{const r=e.target.value;if(L(r),n.general&&o(a=>({...a,general:""})),y.email){const a=p(r);o(g=>({...g,email:a}))}},R=e=>{const r=e.target.value;if(D(r),n.general&&o(a=>({...a,general:""})),y.password){const a=f(r);o(g=>({...g,password:a}))}},j=e=>{if(k(r=>({...r,[e]:!0})),e==="email"){const r=p(d);o(a=>({...a,email:r}))}else if(e==="password"){const r=f(m);o(a=>({...a,password:r}))}},I=()=>{const e=p(d),r=f(m);return o({email:e,password:r}),k({email:!0,password:!0}),!e&&!r},v=async()=>{if(I()){x(!0),o(e=>({...e,general:""}));try{const r={[d.includes("@")&&!d.startsWith("@DA")?"email":"dyanpittId"]:d,password:m,rememberMe:b},a=E(r),g=new Promise((c,w)=>setTimeout(()=>w(new Error("Login timeout - please try again")),3e4)),u=await Promise.race([a,g]);if(u.success&&u.user){sessionStorage.setItem("cameFromRegistration","false");const c=u.user,w=N.state?.fromRegistration;c.role==="admin"||c.role==="super_admin"?t("/admin-dashboard"):w?t("/dashboard"):c.membershipCompleted?c.bookingCompleted?t("/dashboard"):t("/booking"):t("/membership")}else o(c=>({...c,general:u.message||"Login failed. Please check your credentials and try again."}))}catch(e){console.error("🚨 Login error:",e);let r="Login failed. Please check your credentials and try again.";e.message.includes("timeout")?r="Login is taking too long. Please check your connection and try again.":e.message.includes("Network error")?r="Network error. Please check your internet connection and try again.":e.message&&(r=e.message),o(a=>({...a,general:r}))}finally{x(!1)}}},B=()=>{t("/register")},F=()=>{t("/forgot-password")},P=e=>{e.key==="Enter"&&!i&&v()};return s.jsxs("div",{className:"main-container login-screen-container",children:[s.jsxs(K,{to:"/",className:"back-button",children:[s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M19 12H5M12 19L5 12L12 5",stroke:"#ffffff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"← Back"]}),s.jsxs("div",{className:"header-section login-screen-header",children:[s.jsx("div",{className:"logo-container",style:{textAlign:"center",marginBottom:"2rem"},children:s.jsx("img",{src:"./Logo.png",alt:"Logo",style:{width:"150px",height:"150px",objectFit:"contain",borderRadius:"50%"}})}),s.jsx("h1",{className:"main-title login-screen-title",children:"Welcome Back"}),s.jsx("div",{className:"login-dont-have-account",children:s.jsxs("p",{children:["Don't have an account?"," ",s.jsx("button",{onClick:B,disabled:i,children:"Sign up"})]})})]}),n.general&&s.jsx("div",{className:"error-message general-error login-screen-general-error",children:n.general}),s.jsxs("div",{className:"input-group login-screen-input-group",children:[s.jsx("label",{className:"input-label login-screen-input-label",children:"Email or Dyanpeeth Abhyasika ID"}),s.jsx("input",{type:"text",placeholder:"Enter your email or Dyanpeeth Abhyasika ID",value:d,onChange:C,onBlur:()=>j("email"),onKeyPress:P,className:`form-input login-screen-form-input ${n.email?"error":""}`,disabled:i}),n.email&&s.jsx("div",{className:"error-message login-screen-error-message",children:n.email})]}),s.jsxs("div",{className:"input-group login-screen-input-group",style:{marginTop:"1px"},children:[s.jsx("label",{className:"input-label login-screen-input-label",children:"Password"}),s.jsxs("div",{className:"password-wrapper login-screen-password-wrapper",children:[s.jsx("input",{type:h?"text":"password",placeholder:"Enter your password",value:m,onChange:R,onBlur:()=>j("password"),onKeyPress:P,className:`form-input login-screen-form-input login-screen-password-input ${n.password?"error":""}`,disabled:i}),s.jsx("button",{type:"button",onClick:()=>S(!h),className:"password-toggle login-screen-password-toggle",disabled:i,children:h?s.jsx(T,{size:20}):s.jsx(q,{size:20})})]}),n.password&&s.jsx("div",{className:"error-message login-screen-error-message",children:n.password})]}),s.jsxs("div",{className:"form-options login-screen-form-options",children:[s.jsxs("label",{className:"remember-me login-screen-remember-me",children:[s.jsx("input",{type:"checkbox",className:"checkbox login-screen-checkbox",checked:b,onChange:e=>A(e.target.checked),disabled:i}),s.jsx("span",{className:"checkbox-label",children:"Remember me"})]}),s.jsx("button",{onClick:F,className:"forgot-password login-screen-forgot-password",disabled:i,children:"Forgot Password?"})]}),s.jsx("button",{onClick:v,className:"login-button login-screen-submit-button",disabled:i,children:i?"Signing In...":"Sign In"})]})}export{H as default};
