import{u as W,a as $,b as q,r as c,j as s,L as K}from"./index-DUV06g7s.js";import{E as T,a as _}from"./eye-BSjtlWv8.js";import"./createLucideIcon-BKxL3LQ9.js";function J(){const n=W(),N=$(),{login:E}=q(),[d,L]=c.useState(""),[m,D]=c.useState(""),[h,S]=c.useState(!1),[b,A]=c.useState(!1),[i,x]=c.useState(!1),[o,t]=c.useState({}),[y,k]=c.useState({});c.useEffect(()=>{new URLSearchParams(window.location.search).get("token")&&(window.history.replaceState({},document.title,window.location.pathname),n("/dashboard"))},[n]);const p=e=>{const r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,a=/^@DA\d{9}$/;return e?e.trim().length===0?"Please enter your email address or Dyanpeeth Abhyasika ID":e.startsWith("@DA")?a.test(e)?"":"Invalid Dyanpeeth Abhyasika ID format. Should be @DA followed by 9 digits (e.g., @DA202507001)":e.includes("@")?r.test(e)?e.length>254?"Email address is too long (maximum 254 characters)":"":"Please enter a valid email address (e.g., user@example.com)":"Please enter a valid email address or Dyanpeeth Abhyasika ID (starts with @DA)":"Email address or Dyanpeeth Abhyasika ID is required"},f=e=>e?e.length<6?"Password must be at least 6 characters long":"":"Password is required",C=e=>{const r=e.target.value;if(L(r),o.general&&t(a=>({...a,general:""})),y.email){const a=p(r);t(g=>({...g,email:a}))}},R=e=>{const r=e.target.value;if(D(r),o.general&&t(a=>({...a,general:""})),y.password){const a=f(r);t(g=>({...g,password:a}))}},j=e=>{if(k(r=>({...r,[e]:!0})),e==="email"){const r=p(d);t(a=>({...a,email:r}))}else if(e==="password"){const r=f(m);t(a=>({...a,password:r}))}},B=()=>{const e=p(d),r=f(m);return t({email:e,password:r}),k({email:!0,password:!0}),!e&&!r},v=async()=>{if(B()){x(!0),t(e=>({...e,general:""}));try{const r={[d.includes("@")&&!d.startsWith("@DA")?"email":"dyanpittId"]:d,password:m,rememberMe:b},a=E(r),g=new Promise((l,w)=>setTimeout(()=>w(new Error("Login timeout - please try again")),3e4)),u=await Promise.race([a,g]);if(u.success&&u.user){sessionStorage.setItem("cameFromRegistration","false");const l=u.user,w=N.state?.fromRegistration;l.role==="admin"||l.role==="super_admin"?n("/admin-dashboard"):w?n("/dashboard"):l.membershipCompleted?l.bookings?.some(M=>M.paymentStatus==="cash_pending")||l.pendingCashPaymentRequest?(console.log("ðŸ”„ LoginScreen: Redirecting user with cash pending payment"),n("/cash-payment-pending",{replace:!0})):l.bookingCompleted?n("/dashboard"):n("/booking"):n("/membership")}else t(l=>({...l,general:u.message||"Login failed. Please check your credentials and try again."}))}catch(e){console.error("ðŸš¨ Login error:",e);let r="Login failed. Please check your credentials and try again.";e.message.includes("timeout")?r="Login is taking too long. Please check your connection and try again.":e.message.includes("Network error")?r="Network error. Please check your internet connection and try again.":e.message&&(r=e.message),t(a=>({...a,general:r}))}finally{x(!1)}}},I=()=>{n("/register")},F=()=>{n("/forgot-password")},P=e=>{e.key==="Enter"&&!i&&v()};return s.jsxs("div",{className:"main-container login-screen-container",children:[s.jsxs(K,{to:"/",className:"back-button",children:[s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M19 12H5M12 19L5 12L12 5",stroke:"#ffffff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"â† Back"]}),s.jsxs("div",{className:"header-section login-screen-header",children:[s.jsx("div",{className:"logo-container",style:{textAlign:"center",marginBottom:"2rem"},children:s.jsx("img",{src:"./Logo.png",alt:"Logo",style:{width:"150px",height:"150px",objectFit:"contain",borderRadius:"50%"}})}),s.jsx("h1",{className:"main-title login-screen-title",children:"Welcome Back"}),s.jsx("div",{className:"login-dont-have-account",children:s.jsxs("p",{children:["Don't have an account?"," ",s.jsx("button",{onClick:I,disabled:i,children:"Sign up"})]})})]}),o.general&&s.jsx("div",{className:"error-message general-error login-screen-general-error",children:o.general}),s.jsxs("div",{className:"input-group login-screen-input-group",children:[s.jsx("label",{className:"input-label login-screen-input-label",children:"Email or Dyanpeeth Abhyasika ID"}),s.jsx("input",{type:"text",placeholder:"Enter your email or Dyanpeeth Abhyasika ID",value:d,onChange:C,onBlur:()=>j("email"),onKeyPress:P,className:`form-input login-screen-form-input ${o.email?"error":""}`,disabled:i}),o.email&&s.jsx("div",{className:"error-message login-screen-error-message",children:o.email})]}),s.jsxs("div",{className:"input-group login-screen-input-group",style:{marginTop:"1px"},children:[s.jsx("label",{className:"input-label login-screen-input-label",children:"Password"}),s.jsxs("div",{className:"password-wrapper login-screen-password-wrapper",children:[s.jsx("input",{type:h?"text":"password",placeholder:"Enter your password",value:m,onChange:R,onBlur:()=>j("password"),onKeyPress:P,className:`form-input login-screen-form-input login-screen-password-input ${o.password?"error":""}`,disabled:i}),s.jsx("button",{type:"button",onClick:()=>S(!h),className:"password-toggle login-screen-password-toggle",disabled:i,children:h?s.jsx(T,{size:20}):s.jsx(_,{size:20})})]}),o.password&&s.jsx("div",{className:"error-message login-screen-error-message",children:o.password})]}),s.jsxs("div",{className:"form-options login-screen-form-options",children:[s.jsxs("label",{className:"remember-me login-screen-remember-me",children:[s.jsx("input",{type:"checkbox",className:"checkbox login-screen-checkbox",checked:b,onChange:e=>A(e.target.checked),disabled:i}),s.jsx("span",{className:"checkbox-label",children:"Remember me"})]}),s.jsx("button",{onClick:F,className:"forgot-password login-screen-forgot-password",disabled:i,children:"Forgot Password?"})]}),s.jsx("button",{onClick:v,className:"login-button login-screen-submit-button",disabled:i,children:i?"Signing In...":"Sign In"})]})}export{J as default};
